import{g as er,C as dn}from"./CSSPlugin-83f15978.js";import{e as Ws,s as tr,v as un,x as cn,f as Ii,y as Ui,k as Rr,o as ps,c as Gs,a as Vt,z as fn,A as Sr,F as Er,B as Mr,C as ui,D as pn,E as gn,j as Cr,g as Ar,G as _n,H as mn,i as ir,I as xn}from"./index-74a35a00.js";import{_ as yn}from"./_plugin-vue_export-helper-c27b6911.js";function sr(o,e){for(var t=0;t<e.length;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(o,i.key,i)}}function bn(o,e,t){return e&&sr(o.prototype,e),t&&sr(o,t),o}/*!
 * Observer 3.12.2
 * https://greensock.com
 *
 * @license Copyright 2008-2023, GreenSock. All rights reserved.
 * Subject to the terms at https://greensock.com/standard-license or for
 * Club GreenSock members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/var Te,Ds,Ze,Lt,zt,_i,kr,Qt,Ai,Dr,St,dt,Fr,Or=function(){return Te||typeof window<"u"&&(Te=window.gsap)&&Te.registerPlugin&&Te},Lr=1,pi=[],O=[],yt=[],ki=Date.now,Fs=function(e,t){return t},vn=function(){var e=Ai.core,t=e.bridge||{},i=e._scrollers,s=e._proxies;i.push.apply(i,O),s.push.apply(s,yt),O=i,yt=s,Fs=function(n,a){return t[n](a)}},It=function(e,t){return~yt.indexOf(e)&&yt[yt.indexOf(e)+1][t]},Di=function(e){return!!~Dr.indexOf(e)},Fe=function(e,t,i,s,r){return e.addEventListener(t,i,{passive:!s,capture:!!r})},De=function(e,t,i,s){return e.removeEventListener(t,i,!!s)},Gi="scrollLeft",Xi="scrollTop",Os=function(){return St&&St.isPressed||O.cache++},ds=function(e,t){var i=function s(r){if(r||r===0){Lr&&(Ze.history.scrollRestoration="manual");var n=St&&St.isPressed;r=s.v=Math.round(r)||(St&&St.iOS?1:0),e(r),s.cacheID=O.cache,n&&Fs("ss",r)}else(t||O.cache!==s.cacheID||Fs("ref"))&&(s.cacheID=O.cache,s.v=e());return s.v+s.offset};return i.offset=0,e&&i},Ve={s:Gi,p:"left",p2:"Left",os:"right",os2:"Right",d:"width",d2:"Width",a:"x",sc:ds(function(o){return arguments.length?Ze.scrollTo(o,ge.sc()):Ze.pageXOffset||Lt[Gi]||zt[Gi]||_i[Gi]||0})},ge={s:Xi,p:"top",p2:"Top",os:"bottom",os2:"Bottom",d:"height",d2:"Height",a:"y",op:Ve,sc:ds(function(o){return arguments.length?Ze.scrollTo(Ve.sc(),o):Ze.pageYOffset||Lt[Xi]||zt[Xi]||_i[Xi]||0})},Ge=function(e,t){return(t&&t._ctx&&t._ctx.selector||Te.utils.toArray)(e)[0]||(typeof e=="string"&&Te.config().nullTargetWarn!==!1?console.warn("Element not found:",e):null)},Ut=function(e,t){var i=t.s,s=t.sc;Di(e)&&(e=Lt.scrollingElement||zt);var r=O.indexOf(e),n=s===ge.sc?1:2;!~r&&(r=O.push(e)-1),O[r+n]||Fe(e,"scroll",Os);var a=O[r+n],h=a||(O[r+n]=ds(It(e,i),!0)||(Di(e)?s:ds(function(u){return arguments.length?e[i]=u:e[i]})));return h.target=e,a||(h.smooth=Te.getProperty(e,"scrollBehavior")==="smooth"),h},Ls=function(e,t,i){var s=e,r=e,n=ki(),a=n,h=t||50,u=Math.max(500,h*3),p=function(g,C){var S=ki();C||S-n>h?(r=s,s=g,a=n,n=S):i?s+=g:s=r+(g-r)/(S-a)*(n-a)},_=function(){r=s=i?0:s,a=n=0},f=function(g){var C=a,S=r,z=ki();return(g||g===0)&&g!==s&&p(g),n===a||z-a>u?0:(s+(i?S:-S))/((i?z:n)-C)*1e3};return{update:p,reset:_,getVelocity:f}},Ti=function(e,t){return t&&!e._gsapAllow&&e.preventDefault(),e.changedTouches?e.changedTouches[0]:e},rr=function(e){var t=Math.max.apply(Math,e),i=Math.min.apply(Math,e);return Math.abs(t)>=Math.abs(i)?t:i},zr=function(){Ai=Te.core.globals().ScrollTrigger,Ai&&Ai.core&&vn()},Vr=function(e){return Te=e||Or(),Te&&typeof document<"u"&&document.body&&(Ze=window,Lt=document,zt=Lt.documentElement,_i=Lt.body,Dr=[Ze,Lt,zt,_i],Te.utils.clamp,Fr=Te.core.context||function(){},Qt="onpointerenter"in _i?"pointer":"mouse",kr=ce.isTouch=Ze.matchMedia&&Ze.matchMedia("(hover: none), (pointer: coarse)").matches?1:"ontouchstart"in Ze||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0?2:0,dt=ce.eventTypes=("ontouchstart"in zt?"touchstart,touchmove,touchcancel,touchend":"onpointerdown"in zt?"pointerdown,pointermove,pointercancel,pointerup":"mousedown,mousemove,mouseup,mouseup").split(","),setTimeout(function(){return Lr=0},500),zr(),Ds=1),Ds};Ve.op=ge;O.cache=0;var ce=function(){function o(t){this.init(t)}var e=o.prototype;return e.init=function(i){Ds||Vr(Te)||console.warn("Please gsap.registerPlugin(Observer)"),Ai||zr();var s=i.tolerance,r=i.dragMinimum,n=i.type,a=i.target,h=i.lineHeight,u=i.debounce,p=i.preventDefault,_=i.onStop,f=i.onStopDelay,d=i.ignore,g=i.wheelSpeed,C=i.event,S=i.onDragStart,z=i.onDragEnd,E=i.onDrag,B=i.onPress,v=i.onRelease,j=i.onRight,A=i.onLeft,b=i.onUp,q=i.onDown,Q=i.onChangeX,y=i.onChangeY,H=i.onChange,w=i.onToggleX,_e=i.onToggleY,Y=i.onHover,K=i.onHoverEnd,k=i.onMove,X=i.ignoreCheck,J=i.isNormalizer,ee=i.onGestureStart,l=i.onGestureEnd,fe=i.onWheel,Nt=i.onEnable,At=i.onDisable,Ke=i.onClick,vt=i.scrollSpeed,Ce=i.capture,he=i.allowClicks,Ae=i.lockAxis,Re=i.onLockAxis;this.target=a=Ge(a)||zt,this.vars=i,d&&(d=Te.utils.toArray(d)),s=s||1e-9,r=r||0,g=g||1,vt=vt||1,n=n||"wheel,touch,pointer",u=u!==!1,h||(h=parseFloat(Ze.getComputedStyle(_i).lineHeight)||22);var kt,Ne,ct,W,le,Be,Xe,c=this,He=0,wt=0,Bt=Ut(a,Ve),de=Ut(a,ge),Wt=Bt(),Gt=de(),bi=~n.indexOf("touch")&&!~n.indexOf("pointer")&&dt[0]==="pointerdown",be=Di(a),ae=a.ownerDocument||Lt,rt=[0,0,0],nt=[0,0,0],Xt=0,Pt=function(){return Xt=ki()},ft=function(P,G){return(c.event=P)&&d&&~d.indexOf(P.target)||G&&bi&&P.pointerType!=="touch"||X&&X(P,G)},We=function(){c._vx.reset(),c._vy.reset(),Ne.pause(),_&&_(c)},Ht=function(){var P=c.deltaX=rr(rt),G=c.deltaY=rr(nt),ne=Math.abs(P)>=s,m=Math.abs(G)>=s;H&&(ne||m)&&H(c,P,G,rt,nt),ne&&(j&&c.deltaX>0&&j(c),A&&c.deltaX<0&&A(c),Q&&Q(c),w&&c.deltaX<0!=He<0&&w(c),He=c.deltaX,rt[0]=rt[1]=rt[2]=0),m&&(q&&c.deltaY>0&&q(c),b&&c.deltaY<0&&b(c),y&&y(c),_e&&c.deltaY<0!=wt<0&&_e(c),wt=c.deltaY,nt[0]=nt[1]=nt[2]=0),(W||ct)&&(k&&k(c),ct&&(E(c),ct=!1),W=!1),Be&&!(Be=!1)&&Re&&Re(c),le&&(fe(c),le=!1),kt=0},ai=function(P,G,ne){rt[ne]+=P,nt[ne]+=G,c._vx.update(P),c._vy.update(G),u?kt||(kt=requestAnimationFrame(Ht)):Ht()},oi=function(P,G){Ae&&!Xe&&(c.axis=Xe=Math.abs(P)>Math.abs(G)?"x":"y",Be=!0),Xe!=="y"&&(rt[2]+=P,c._vx.update(P,!0)),Xe!=="x"&&(nt[2]+=G,c._vy.update(G,!0)),u?kt||(kt=requestAnimationFrame(Ht)):Ht()},Yt=function(P){if(!ft(P,1)){P=Ti(P,p);var G=P.clientX,ne=P.clientY,m=G-c.x,I=ne-c.y,T=c.isDragging;c.x=G,c.y=ne,(T||Math.abs(c.startX-G)>=r||Math.abs(c.startY-ne)>=r)&&(E&&(ct=!0),T||(c.isDragging=!0),oi(m,I),T||S&&S(c))}},Dt=c.onPress=function(M){ft(M,1)||M&&M.button||(c.axis=Xe=null,Ne.pause(),c.isPressed=!0,M=Ti(M),He=wt=0,c.startX=c.x=M.clientX,c.startY=c.y=M.clientY,c._vx.reset(),c._vy.reset(),Fe(J?a:ae,dt[1],Yt,p,!0),c.deltaX=c.deltaY=0,B&&B(c))},Ft=c.onRelease=function(M){if(!ft(M,1)){De(J?a:ae,dt[1],Yt,!0);var P=!isNaN(c.y-c.startY),G=c.isDragging&&(Math.abs(c.x-c.startX)>3||Math.abs(c.y-c.startY)>3),ne=Ti(M);!G&&P&&(c._vx.reset(),c._vy.reset(),p&&he&&Te.delayedCall(.08,function(){if(ki()-Xt>300&&!M.defaultPrevented){if(M.target.click)M.target.click();else if(ae.createEvent){var m=ae.createEvent("MouseEvents");m.initMouseEvent("click",!0,!0,Ze,1,ne.screenX,ne.screenY,ne.clientX,ne.clientY,!1,!1,!1,!1,0,null),M.target.dispatchEvent(m)}}})),c.isDragging=c.isGesturing=c.isPressed=!1,_&&!J&&Ne.restart(!0),z&&G&&z(c),v&&v(c,G)}},U=function(P){return P.touches&&P.touches.length>1&&(c.isGesturing=!0)&&ee(P,c.isDragging)},jt=function(){return(c.isGesturing=!1)||l(c)},at=function(P){if(!ft(P)){var G=Bt(),ne=de();ai((G-Wt)*vt,(ne-Gt)*vt,1),Wt=G,Gt=ne,_&&Ne.restart(!0)}},ot=function(P){if(!ft(P)){P=Ti(P,p),fe&&(le=!0);var G=(P.deltaMode===1?h:P.deltaMode===2?Ze.innerHeight:1)*g;ai(P.deltaX*G,P.deltaY*G,0),_&&!J&&Ne.restart(!0)}},ht=function(P){if(!ft(P)){var G=P.clientX,ne=P.clientY,m=G-c.x,I=ne-c.y;c.x=G,c.y=ne,W=!0,(m||I)&&oi(m,I)}},$t=function(P){c.event=P,Y(c)},hi=function(P){c.event=P,K(c)},Tt=function(P){return ft(P)||Ti(P,p)&&Ke(c)};Ne=c._dc=Te.delayedCall(f||.25,We).pause(),c.deltaX=c.deltaY=0,c._vx=Ls(0,50,!0),c._vy=Ls(0,50,!0),c.scrollX=Bt,c.scrollY=de,c.isDragging=c.isGesturing=c.isPressed=!1,Fr(this),c.enable=function(M){return c.isEnabled||(Fe(be?ae:a,"scroll",Os),n.indexOf("scroll")>=0&&Fe(be?ae:a,"scroll",at,p,Ce),n.indexOf("wheel")>=0&&Fe(a,"wheel",ot,p,Ce),(n.indexOf("touch")>=0&&kr||n.indexOf("pointer")>=0)&&(Fe(a,dt[0],Dt,p,Ce),Fe(ae,dt[2],Ft),Fe(ae,dt[3],Ft),he&&Fe(a,"click",Pt,!1,!0),Ke&&Fe(a,"click",Tt),ee&&Fe(ae,"gesturestart",U),l&&Fe(ae,"gestureend",jt),Y&&Fe(a,Qt+"enter",$t),K&&Fe(a,Qt+"leave",hi),k&&Fe(a,Qt+"move",ht)),c.isEnabled=!0,M&&M.type&&Dt(M),Nt&&Nt(c)),c},c.disable=function(){c.isEnabled&&(pi.filter(function(M){return M!==c&&Di(M.target)}).length||De(be?ae:a,"scroll",Os),c.isPressed&&(c._vx.reset(),c._vy.reset(),De(J?a:ae,dt[1],Yt,!0)),De(be?ae:a,"scroll",at,Ce),De(a,"wheel",ot,Ce),De(a,dt[0],Dt,Ce),De(ae,dt[2],Ft),De(ae,dt[3],Ft),De(a,"click",Pt,!0),De(a,"click",Tt),De(ae,"gesturestart",U),De(ae,"gestureend",jt),De(a,Qt+"enter",$t),De(a,Qt+"leave",hi),De(a,Qt+"move",ht),c.isEnabled=c.isPressed=c.isDragging=!1,At&&At(c))},c.kill=c.revert=function(){c.disable();var M=pi.indexOf(c);M>=0&&pi.splice(M,1),St===c&&(St=0)},pi.push(c),J&&Di(a)&&(St=c),c.enable(C)},bn(o,[{key:"velocityX",get:function(){return this._vx.getVelocity()}},{key:"velocityY",get:function(){return this._vy.getVelocity()}}]),o}();ce.version="3.12.2";ce.create=function(o){return new ce(o)};ce.register=Vr;ce.getAll=function(){return pi.slice()};ce.getById=function(o){return pi.filter(function(e){return e.vars.id===o})[0]};Or()&&Te.registerPlugin(ce);/*!
 * ScrollTrigger 3.12.2
 * https://greensock.com
 *
 * @license Copyright 2008-2023, GreenSock. All rights reserved.
 * Subject to the terms at https://greensock.com/standard-license or for
 * Club GreenSock members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/var x,ci,V,se,ut,Z,Ir,us,cs,gi,ss,Hi,Me,gs,zs,Oe,nr,ar,fi,Ur,ws,Nr,$e,Br,Wr,Gr,Ot,Vs,Xs,mi,Hs,Ps,Yi=1,ze=Date.now,Ts=ze(),st=0,Si=0,or=function(e,t,i){var s=Qe(e)&&(e.substr(0,6)==="clamp("||e.indexOf("max")>-1);return i["_"+t+"Clamp"]=s,s?e.substr(6,e.length-7):e},hr=function(e,t){return t&&(!Qe(e)||e.substr(0,6)!=="clamp(")?"clamp("+e+")":e},wn=function o(){return Si&&requestAnimationFrame(o)},lr=function(){return gs=1},dr=function(){return gs=0},xt=function(e){return e},Ei=function(e){return Math.round(e*1e5)/1e5||0},Xr=function(){return typeof window<"u"},Hr=function(){return x||Xr()&&(x=window.gsap)&&x.registerPlugin&&x},si=function(e){return!!~Ir.indexOf(e)},Yr=function(e){return(e==="Height"?Hs:V["inner"+e])||ut["client"+e]||Z["client"+e]},jr=function(e){return It(e,"getBoundingClientRect")||(si(e)?function(){return ls.width=V.innerWidth,ls.height=Hs,ls}:function(){return Rt(e)})},Pn=function(e,t,i){var s=i.d,r=i.d2,n=i.a;return(n=It(e,"getBoundingClientRect"))?function(){return n()[s]}:function(){return(t?Yr(r):e["client"+r])||0}},Tn=function(e,t){return!t||~yt.indexOf(e)?jr(e):function(){return ls}},Et=function(e,t){var i=t.s,s=t.d2,r=t.d,n=t.a;return Math.max(0,(i="scroll"+s)&&(n=It(e,i))?n()-jr(e)()[r]:si(e)?(ut[i]||Z[i])-Yr(s):e[i]-e["offset"+s])},ji=function(e,t){for(var i=0;i<fi.length;i+=3)(!t||~t.indexOf(fi[i+1]))&&e(fi[i],fi[i+1],fi[i+2])},Qe=function(e){return typeof e=="string"},Ie=function(e){return typeof e=="function"},rs=function(e){return typeof e=="number"},Zt=function(e){return typeof e=="object"},Ri=function(e,t,i){return e&&e.progress(t?0:1)&&i&&e.pause()},Rs=function(e,t){if(e.enabled){var i=t(e);i&&i.totalTime&&(e.callbackAnimation=i)}},li=Math.abs,$r="left",qr="top",Ys="right",js="bottom",ei="width",ti="height",Fi="Right",Oi="Left",Li="Top",zi="Bottom",ue="padding",tt="margin",yi="Width",$s="Height",Pe="px",it=function(e){return V.getComputedStyle(e)},Rn=function(e){var t=it(e).position;e.style.position=t==="absolute"||t==="fixed"?t:"relative"},ur=function(e,t){for(var i in t)i in e||(e[i]=t[i]);return e},Rt=function(e,t){var i=t&&it(e)[zs]!=="matrix(1, 0, 0, 1, 0, 0)"&&x.to(e,{x:0,y:0,xPercent:0,yPercent:0,rotation:0,rotationX:0,rotationY:0,scale:1,skewX:0,skewY:0}).progress(1),s=e.getBoundingClientRect();return i&&i.progress(0).kill(),s},Is=function(e,t){var i=t.d2;return e["offset"+i]||e["client"+i]||0},Qr=function(e){var t=[],i=e.labels,s=e.duration(),r;for(r in i)t.push(i[r]/s);return t},Sn=function(e){return function(t){return x.utils.snap(Qr(e),t)}},qs=function(e){var t=x.utils.snap(e),i=Array.isArray(e)&&e.slice(0).sort(function(s,r){return s-r});return i?function(s,r,n){n===void 0&&(n=.001);var a;if(!r)return t(s);if(r>0){for(s-=n,a=0;a<i.length;a++)if(i[a]>=s)return i[a];return i[a-1]}else for(a=i.length,s+=n;a--;)if(i[a]<=s)return i[a];return i[0]}:function(s,r,n){n===void 0&&(n=.001);var a=t(s);return!r||Math.abs(a-s)<n||a-s<0==r<0?a:t(r<0?s-e:s+e)}},En=function(e){return function(t,i){return qs(Qr(e))(t,i.direction)}},$i=function(e,t,i,s){return i.split(",").forEach(function(r){return e(t,r,s)})},ye=function(e,t,i,s,r){return e.addEventListener(t,i,{passive:!s,capture:!!r})},xe=function(e,t,i,s){return e.removeEventListener(t,i,!!s)},qi=function(e,t,i){i=i&&i.wheelHandler,i&&(e(t,"wheel",i),e(t,"touchmove",i))},cr={startColor:"green",endColor:"red",indent:0,fontSize:"16px",fontWeight:"normal"},Qi={toggleActions:"play",anticipatePin:0},fs={top:0,left:0,center:.5,bottom:1,right:1},ns=function(e,t){if(Qe(e)){var i=e.indexOf("="),s=~i?+(e.charAt(i-1)+1)*parseFloat(e.substr(i+1)):0;~i&&(e.indexOf("%")>i&&(s*=t/100),e=e.substr(0,i-1)),e=s+(e in fs?fs[e]*t:~e.indexOf("%")?parseFloat(e)*t/100:parseFloat(e)||0)}return e},Zi=function(e,t,i,s,r,n,a,h){var u=r.startColor,p=r.endColor,_=r.fontSize,f=r.indent,d=r.fontWeight,g=se.createElement("div"),C=si(i)||It(i,"pinType")==="fixed",S=e.indexOf("scroller")!==-1,z=C?Z:i,E=e.indexOf("start")!==-1,B=E?u:p,v="border-color:"+B+";font-size:"+_+";color:"+B+";font-weight:"+d+";pointer-events:none;white-space:nowrap;font-family:sans-serif,Arial;z-index:1000;padding:4px 8px;border-width:0;border-style:solid;";return v+="position:"+((S||h)&&C?"fixed;":"absolute;"),(S||h||!C)&&(v+=(s===ge?Ys:js)+":"+(n+parseFloat(f))+"px;"),a&&(v+="box-sizing:border-box;text-align:left;width:"+a.offsetWidth+"px;"),g._isStart=E,g.setAttribute("class","gsap-marker-"+e+(t?" marker-"+t:"")),g.style.cssText=v,g.innerText=t||t===0?e+"-"+t:e,z.children[0]?z.insertBefore(g,z.children[0]):z.appendChild(g),g._offset=g["offset"+s.op.d2],as(g,0,s,E),g},as=function(e,t,i,s){var r={display:"block"},n=i[s?"os2":"p2"],a=i[s?"p2":"os2"];e._isFlipped=s,r[i.a+"Percent"]=s?-100:0,r[i.a]=s?"1px":0,r["border"+n+yi]=1,r["border"+a+yi]=0,r[i.p]=t+"px",x.set(e,r)},D=[],Us={},Ni,fr=function(){return ze()-st>34&&(Ni||(Ni=requestAnimationFrame(Mt)))},di=function(){(!$e||!$e.isPressed||$e.startX>Z.clientWidth)&&(O.cache++,$e?Ni||(Ni=requestAnimationFrame(Mt)):Mt(),st||ni("scrollStart"),st=ze())},Ss=function(){Gr=V.innerWidth,Wr=V.innerHeight},Mi=function(){O.cache++,!Me&&!Nr&&!se.fullscreenElement&&!se.webkitFullscreenElement&&(!Br||Gr!==V.innerWidth||Math.abs(V.innerHeight-Wr)>V.innerHeight*.25)&&us.restart(!0)},ri={},Mn=[],Zr=function o(){return xe(L,"scrollEnd",o)||Jt(!0)},ni=function(e){return ri[e]&&ri[e].map(function(t){return t()})||Mn},qe=[],Kr=function(e){for(var t=0;t<qe.length;t+=5)(!e||qe[t+4]&&qe[t+4].query===e)&&(qe[t].style.cssText=qe[t+1],qe[t].getBBox&&qe[t].setAttribute("transform",qe[t+2]||""),qe[t+3].uncache=1)},Qs=function(e,t){var i;for(Oe=0;Oe<D.length;Oe++)i=D[Oe],i&&(!t||i._ctx===t)&&(e?i.kill(1):i.revert(!0,!0));t&&Kr(t),t||ni("revert")},Jr=function(e,t){O.cache++,(t||!Le)&&O.forEach(function(i){return Ie(i)&&i.cacheID++&&(i.rec=0)}),Qe(e)&&(V.history.scrollRestoration=Xs=e)},Le,ii=0,pr,Cn=function(){if(pr!==ii){var e=pr=ii;requestAnimationFrame(function(){return e===ii&&Jt(!0)})}},en=function(){Z.appendChild(mi),Hs=mi.offsetHeight||V.innerHeight,Z.removeChild(mi)},Jt=function(e,t){if(st&&!e){ye(L,"scrollEnd",Zr);return}en(),Le=L.isRefreshing=!0,O.forEach(function(s){return Ie(s)&&++s.cacheID&&(s.rec=s())});var i=ni("refreshInit");Ur&&L.sort(),t||Qs(),O.forEach(function(s){Ie(s)&&(s.smooth&&(s.target.style.scrollBehavior="auto"),s(0))}),D.slice(0).forEach(function(s){return s.refresh()}),D.forEach(function(s,r){if(s._subPinOffset&&s.pin){var n=s.vars.horizontal?"offsetWidth":"offsetHeight",a=s.pin[n];s.revert(!0,1),s.adjustPinSpacing(s.pin[n]-a),s.refresh()}}),D.forEach(function(s){var r=Et(s.scroller,s._dir);(s.vars.end==="max"||s._endClamp&&s.end>r)&&s.setPositions(s.start,Math.max(s.start+1,r),!0)}),i.forEach(function(s){return s&&s.render&&s.render(-1)}),O.forEach(function(s){Ie(s)&&(s.smooth&&requestAnimationFrame(function(){return s.target.style.scrollBehavior="smooth"}),s.rec&&s(s.rec))}),Jr(Xs,1),us.pause(),ii++,Le=2,Mt(2),D.forEach(function(s){return Ie(s.vars.onRefresh)&&s.vars.onRefresh(s)}),Le=L.isRefreshing=!1,ni("refresh")},Ns=0,os=1,Vi,Mt=function(e){if(!Le||e===2){L.isUpdating=!0,Vi&&Vi.update(0);var t=D.length,i=ze(),s=i-Ts>=50,r=t&&D[0].scroll();if(os=Ns>r?-1:1,Le||(Ns=r),s&&(st&&!gs&&i-st>200&&(st=0,ni("scrollEnd")),ss=Ts,Ts=i),os<0){for(Oe=t;Oe-- >0;)D[Oe]&&D[Oe].update(0,s);os=1}else for(Oe=0;Oe<t;Oe++)D[Oe]&&D[Oe].update(0,s);L.isUpdating=!1}Ni=0},Bs=[$r,qr,js,Ys,tt+zi,tt+Fi,tt+Li,tt+Oi,"display","flexShrink","float","zIndex","gridColumnStart","gridColumnEnd","gridRowStart","gridRowEnd","gridArea","justifySelf","alignSelf","placeSelf","order"],hs=Bs.concat([ei,ti,"boxSizing","max"+yi,"max"+$s,"position",tt,ue,ue+Li,ue+Fi,ue+zi,ue+Oi]),An=function(e,t,i){xi(i);var s=e._gsap;if(s.spacerIsNative)xi(s.spacerState);else if(e._gsap.swappedIn){var r=t.parentNode;r&&(r.insertBefore(e,t),r.removeChild(t))}e._gsap.swappedIn=!1},Es=function(e,t,i,s){if(!e._gsap.swappedIn){for(var r=Bs.length,n=t.style,a=e.style,h;r--;)h=Bs[r],n[h]=i[h];n.position=i.position==="absolute"?"absolute":"relative",i.display==="inline"&&(n.display="inline-block"),a[js]=a[Ys]="auto",n.flexBasis=i.flexBasis||"auto",n.overflow="visible",n.boxSizing="border-box",n[ei]=Is(e,Ve)+Pe,n[ti]=Is(e,ge)+Pe,n[ue]=a[tt]=a[qr]=a[$r]="0",xi(s),a[ei]=a["max"+yi]=i[ei],a[ti]=a["max"+$s]=i[ti],a[ue]=i[ue],e.parentNode!==t&&(e.parentNode.insertBefore(t,e),t.appendChild(e)),e._gsap.swappedIn=!0}},kn=/([A-Z])/g,xi=function(e){if(e){var t=e.t.style,i=e.length,s=0,r,n;for((e.t._gsap||x.core.getCache(e.t)).uncache=1;s<i;s+=2)n=e[s+1],r=e[s],n?t[r]=n:t[r]&&t.removeProperty(r.replace(kn,"-$1").toLowerCase())}},Ki=function(e){for(var t=hs.length,i=e.style,s=[],r=0;r<t;r++)s.push(hs[r],i[hs[r]]);return s.t=e,s},Dn=function(e,t,i){for(var s=[],r=e.length,n=i?8:0,a;n<r;n+=2)a=e[n],s.push(a,a in t?t[a]:e[n+1]);return s.t=e.t,s},ls={left:0,top:0},gr=function(e,t,i,s,r,n,a,h,u,p,_,f,d,g){Ie(e)&&(e=e(h)),Qe(e)&&e.substr(0,3)==="max"&&(e=f+(e.charAt(4)==="="?ns("0"+e.substr(3),i):0));var C=d?d.time():0,S,z,E;if(d&&d.seek(0),isNaN(e)||(e=+e),rs(e))d&&(e=x.utils.mapRange(d.scrollTrigger.start,d.scrollTrigger.end,0,f,e)),a&&as(a,i,s,!0);else{Ie(t)&&(t=t(h));var B=(e||"0").split(" "),v,j,A,b;E=Ge(t,h)||Z,v=Rt(E)||{},(!v||!v.left&&!v.top)&&it(E).display==="none"&&(b=E.style.display,E.style.display="block",v=Rt(E),b?E.style.display=b:E.style.removeProperty("display")),j=ns(B[0],v[s.d]),A=ns(B[1]||"0",i),e=v[s.p]-u[s.p]-p+j+r-A,a&&as(a,A,s,i-A<20||a._isStart&&A>20),i-=i-A}if(g&&(h[g]=e||-.001,e<0&&(e=0)),n){var q=e+i,Q=n._isStart;S="scroll"+s.d2,as(n,q,s,Q&&q>20||!Q&&(_?Math.max(Z[S],ut[S]):n.parentNode[S])<=q+1),_&&(u=Rt(a),_&&(n.style[s.op.p]=u[s.op.p]-s.op.m-n._offset+Pe))}return d&&E&&(S=Rt(E),d.seek(f),z=Rt(E),d._caScrollDist=S[s.p]-z[s.p],e=e/d._caScrollDist*f),d&&d.seek(C),d?e:Math.round(e)},Fn=/(webkit|moz|length|cssText|inset)/i,_r=function(e,t,i,s){if(e.parentNode!==t){var r=e.style,n,a;if(t===Z){e._stOrig=r.cssText,a=it(e);for(n in a)!+n&&!Fn.test(n)&&a[n]&&typeof r[n]=="string"&&n!=="0"&&(r[n]=a[n]);r.top=i,r.left=s}else r.cssText=e._stOrig;x.core.getCache(e).uncache=1,t.appendChild(e)}},tn=function(e,t,i){var s=t,r=s;return function(n){var a=Math.round(e());return a!==s&&a!==r&&Math.abs(a-s)>3&&Math.abs(a-r)>3&&(n=a,i&&i()),r=s,s=n,n}},Ji=function(e,t,i){var s={};s[t.p]="+="+i,x.set(e,s)},mr=function(e,t){var i=Ut(e,t),s="_scroll"+t.p2,r=function n(a,h,u,p,_){var f=n.tween,d=h.onComplete,g={};u=u||i();var C=tn(i,u,function(){f.kill(),n.tween=0});return _=p&&_||0,p=p||a-u,f&&f.kill(),h[s]=a,h.modifiers=g,g[s]=function(){return C(u+p*f.ratio+_*f.ratio*f.ratio)},h.onUpdate=function(){O.cache++,Mt()},h.onComplete=function(){n.tween=0,d&&d.call(f)},f=n.tween=x.to(e,h),f};return e[s]=i,i.wheelHandler=function(){return r.tween&&r.tween.kill()&&(r.tween=0)},ye(e,"wheel",i.wheelHandler),L.isTouch&&ye(e,"touchmove",i.wheelHandler),r},L=function(){function o(t,i){ci||o.register(x)||console.warn("Please gsap.registerPlugin(ScrollTrigger)"),Vs(this),this.init(t,i)}var e=o.prototype;return e.init=function(i,s){if(this.progress=this.start=0,this.vars&&this.kill(!0,!0),!Si){this.update=this.refresh=this.kill=xt;return}i=ur(Qe(i)||rs(i)||i.nodeType?{trigger:i}:i,Qi);var r=i,n=r.onUpdate,a=r.toggleClass,h=r.id,u=r.onToggle,p=r.onRefresh,_=r.scrub,f=r.trigger,d=r.pin,g=r.pinSpacing,C=r.invalidateOnRefresh,S=r.anticipatePin,z=r.onScrubComplete,E=r.onSnapComplete,B=r.once,v=r.snap,j=r.pinReparent,A=r.pinSpacer,b=r.containerAnimation,q=r.fastScrollEnd,Q=r.preventOverlaps,y=i.horizontal||i.containerAnimation&&i.horizontal!==!1?Ve:ge,H=!_&&_!==0,w=Ge(i.scroller||V),_e=x.core.getCache(w),Y=si(w),K=("pinType"in i?i.pinType:It(w,"pinType")||Y&&"fixed")==="fixed",k=[i.onEnter,i.onLeave,i.onEnterBack,i.onLeaveBack],X=H&&i.toggleActions.split(" "),J="markers"in i?i.markers:Qi.markers,ee=Y?0:parseFloat(it(w)["border"+y.p2+yi])||0,l=this,fe=i.onRefreshInit&&function(){return i.onRefreshInit(l)},Nt=Pn(w,Y,y),At=Tn(w,Y),Ke=0,vt=0,Ce=0,he=Ut(w,y),Ae,Re,kt,Ne,ct,W,le,Be,Xe,c,He,wt,Bt,de,Wt,Gt,bi,be,ae,rt,nt,Xt,Pt,ft,We,Ht,ai,oi,Yt,Dt,Ft,U,jt,at,ot,ht,$t,hi,Tt;if(l._startClamp=l._endClamp=!1,l._dir=y,S*=45,l.scroller=w,l.scroll=b?b.time.bind(b):he,Ne=he(),l.vars=i,s=s||i.animation,"refreshPriority"in i&&(Ur=1,i.refreshPriority===-9999&&(Vi=l)),_e.tweenScroll=_e.tweenScroll||{top:mr(w,ge),left:mr(w,Ve)},l.tweenTo=Ae=_e.tweenScroll[y.p],l.scrubDuration=function(m){jt=rs(m)&&m,jt?U?U.duration(m):U=x.to(s,{ease:"expo",totalProgress:"+=0",duration:jt,paused:!0,onComplete:function(){return z&&z(l)}}):(U&&U.progress(1).kill(),U=0)},s&&(s.vars.lazy=!1,s._initted&&!l.isReverted||s.vars.immediateRender!==!1&&i.immediateRender!==!1&&s.duration()&&s.render(0,!0,!0),l.animation=s.pause(),s.scrollTrigger=l,l.scrubDuration(_),Dt=0,h||(h=s.vars.id)),v&&((!Zt(v)||v.push)&&(v={snapTo:v}),"scrollBehavior"in Z.style&&x.set(Y?[Z,ut]:w,{scrollBehavior:"auto"}),O.forEach(function(m){return Ie(m)&&m.target===(Y?se.scrollingElement||ut:w)&&(m.smooth=!1)}),kt=Ie(v.snapTo)?v.snapTo:v.snapTo==="labels"?Sn(s):v.snapTo==="labelsDirectional"?En(s):v.directional!==!1?function(m,I){return qs(v.snapTo)(m,ze()-vt<500?0:I.direction)}:x.utils.snap(v.snapTo),at=v.duration||{min:.1,max:2},at=Zt(at)?gi(at.min,at.max):gi(at,at),ot=x.delayedCall(v.delay||jt/2||.1,function(){var m=he(),I=ze()-vt<500,T=Ae.tween;if((I||Math.abs(l.getVelocity())<10)&&!T&&!gs&&Ke!==m){var F=(m-W)/de,me=s&&!H?s.totalProgress():F,N=I?0:(me-Ft)/(ze()-ss)*1e3||0,oe=x.utils.clamp(-F,1-F,li(N/2)*N/.185),ke=F+(v.inertia===!1?0:oe),ve=gi(0,1,kt(ke,l)),te=Math.round(W+ve*de),$=v,lt=$.onStart,ie=$.onInterrupt,Ye=$.onComplete;if(m<=le&&m>=W&&te!==m){if(T&&!T._initted&&T.data<=li(te-m))return;v.inertia===!1&&(oe=ve-F),Ae(te,{duration:at(li(Math.max(li(ke-me),li(ve-me))*.185/N/.05||0)),ease:v.ease||"power3",data:li(te-m),onInterrupt:function(){return ot.restart(!0)&&ie&&ie(l)},onComplete:function(){l.update(),Ke=he(),Dt=Ft=s&&!H?s.totalProgress():l.progress,E&&E(l),Ye&&Ye(l)}},m,oe*de,te-m-oe*de),lt&&lt(l,Ae.tween)}}else l.isActive&&Ke!==m&&ot.restart(!0)}).pause()),h&&(Us[h]=l),f=l.trigger=Ge(f||d!==!0&&d),Tt=f&&f._gsap&&f._gsap.stRevert,Tt&&(Tt=Tt(l)),d=d===!0?f:Ge(d),Qe(a)&&(a={targets:f,className:a}),d&&(g===!1||g===tt||(g=!g&&d.parentNode&&d.parentNode.style&&it(d.parentNode).display==="flex"?!1:ue),l.pin=d,Re=x.core.getCache(d),Re.spacer?Wt=Re.pinState:(A&&(A=Ge(A),A&&!A.nodeType&&(A=A.current||A.nativeElement),Re.spacerIsNative=!!A,A&&(Re.spacerState=Ki(A))),Re.spacer=be=A||se.createElement("div"),be.classList.add("pin-spacer"),h&&be.classList.add("pin-spacer-"+h),Re.pinState=Wt=Ki(d)),i.force3D!==!1&&x.set(d,{force3D:!0}),l.spacer=be=Re.spacer,Yt=it(d),ft=Yt[g+y.os2],rt=x.getProperty(d),nt=x.quickSetter(d,y.a,Pe),Es(d,be,Yt),bi=Ki(d)),J){wt=Zt(J)?ur(J,cr):cr,c=Zi("scroller-start",h,w,y,wt,0),He=Zi("scroller-end",h,w,y,wt,0,c),ae=c["offset"+y.op.d2];var M=Ge(It(w,"content")||w);Be=this.markerStart=Zi("start",h,M,y,wt,ae,0,b),Xe=this.markerEnd=Zi("end",h,M,y,wt,ae,0,b),b&&(hi=x.quickSetter([Be,Xe],y.a,Pe)),!K&&!(yt.length&&It(w,"fixedMarkers")===!0)&&(Rn(Y?Z:w),x.set([c,He],{force3D:!0}),Ht=x.quickSetter(c,y.a,Pe),oi=x.quickSetter(He,y.a,Pe))}if(b){var P=b.vars.onUpdate,G=b.vars.onUpdateParams;b.eventCallback("onUpdate",function(){l.update(0,0,1),P&&P.apply(b,G||[])})}if(l.previous=function(){return D[D.indexOf(l)-1]},l.next=function(){return D[D.indexOf(l)+1]},l.revert=function(m,I){if(!I)return l.kill(!0);var T=m!==!1||!l.enabled,F=Me;T!==l.isReverted&&(T&&(ht=Math.max(he(),l.scroll.rec||0),Ce=l.progress,$t=s&&s.progress()),Be&&[Be,Xe,c,He].forEach(function(me){return me.style.display=T?"none":"block"}),T&&(Me=l,l.update(T)),d&&(!j||!l.isActive)&&(T?An(d,be,Wt):Es(d,be,it(d),We)),T||l.update(T),Me=F,l.isReverted=T)},l.refresh=function(m,I,T,F){if(!((Me||!l.enabled)&&!I)){if(d&&m&&st){ye(o,"scrollEnd",Zr);return}!Le&&fe&&fe(l),Me=l,Ae.tween&&!T&&(Ae.tween.kill(),Ae.tween=0),U&&U.pause(),C&&s&&s.revert({kill:!1}).invalidate(),l.isReverted||l.revert(!0,!0),l._subPinOffset=!1;var me=Nt(),N=At(),oe=b?b.duration():Et(w,y),ke=de<=.01,ve=0,te=F||0,$=Zt(T)?T.end:i.end,lt=i.endTrigger||f,ie=Zt(T)?T.start:i.start||(i.start===0||!f?0:d?"0 0":"0 100%"),Ye=l.pinnedContainer=i.pinnedContainer&&Ge(i.pinnedContainer,l),pt=f&&Math.max(0,D.indexOf(l))||0,je=pt,we,Se,qt,Bi,Ee,pe,gt,vs,Js,vi,_t,wi,Wi;for(J&&Zt(T)&&(wi=x.getProperty(c,y.p),Wi=x.getProperty(He,y.p));je--;)pe=D[je],pe.end||pe.refresh(0,1)||(Me=l),gt=pe.pin,gt&&(gt===f||gt===d||gt===Ye)&&!pe.isReverted&&(vi||(vi=[]),vi.unshift(pe),pe.revert(!0,!0)),pe!==D[je]&&(pt--,je--);for(Ie(ie)&&(ie=ie(l)),ie=or(ie,"start",l),W=gr(ie,f,me,y,he(),Be,c,l,N,ee,K,oe,b,l._startClamp&&"_startClamp")||(d?-.001:0),Ie($)&&($=$(l)),Qe($)&&!$.indexOf("+=")&&(~$.indexOf(" ")?$=(Qe(ie)?ie.split(" ")[0]:"")+$:(ve=ns($.substr(2),me),$=Qe(ie)?ie:(b?x.utils.mapRange(0,b.duration(),b.scrollTrigger.start,b.scrollTrigger.end,W):W)+ve,lt=f)),$=or($,"end",l),le=Math.max(W,gr($||(lt?"100% 0":oe),lt,me,y,he()+ve,Xe,He,l,N,ee,K,oe,b,l._endClamp&&"_endClamp"))||-.001,ve=0,je=pt;je--;)pe=D[je],gt=pe.pin,gt&&pe.start-pe._pinPush<=W&&!b&&pe.end>0&&(we=pe.end-(l._startClamp?Math.max(0,pe.start):pe.start),(gt===f&&pe.start-pe._pinPush<W||gt===Ye)&&isNaN(ie)&&(ve+=we*(1-pe.progress)),gt===d&&(te+=we));if(W+=ve,le+=ve,l._startClamp&&(l._startClamp+=ve),l._endClamp&&!Le&&(l._endClamp=le||-.001,le=Math.min(le,Et(w,y))),de=le-W||(W-=.01)&&.001,ke&&(Ce=x.utils.clamp(0,1,x.utils.normalize(W,le,ht))),l._pinPush=te,Be&&ve&&(we={},we[y.a]="+="+ve,Ye&&(we[y.p]="-="+he()),x.set([Be,Xe],we)),d)we=it(d),Bi=y===ge,qt=he(),Xt=parseFloat(rt(y.a))+te,!oe&&le>1&&(_t=(Y?se.scrollingElement||ut:w).style,_t={style:_t,value:_t["overflow"+y.a.toUpperCase()]},Y&&it(Z)["overflow"+y.a.toUpperCase()]!=="scroll"&&(_t.style["overflow"+y.a.toUpperCase()]="scroll")),Es(d,be,we),bi=Ki(d),Se=Rt(d,!0),vs=K&&Ut(w,Bi?Ve:ge)(),g&&(We=[g+y.os2,de+te+Pe],We.t=be,je=g===ue?Is(d,y)+de+te:0,je&&We.push(y.d,je+Pe),xi(We),Ye&&D.forEach(function(Pi){Pi.pin===Ye&&Pi.vars.pinSpacing!==!1&&(Pi._subPinOffset=!0)}),K&&he(ht)),K&&(Ee={top:Se.top+(Bi?qt-W:vs)+Pe,left:Se.left+(Bi?vs:qt-W)+Pe,boxSizing:"border-box",position:"fixed"},Ee[ei]=Ee["max"+yi]=Math.ceil(Se.width)+Pe,Ee[ti]=Ee["max"+$s]=Math.ceil(Se.height)+Pe,Ee[tt]=Ee[tt+Li]=Ee[tt+Fi]=Ee[tt+zi]=Ee[tt+Oi]="0",Ee[ue]=we[ue],Ee[ue+Li]=we[ue+Li],Ee[ue+Fi]=we[ue+Fi],Ee[ue+zi]=we[ue+zi],Ee[ue+Oi]=we[ue+Oi],Gt=Dn(Wt,Ee,j),Le&&he(0)),s?(Js=s._initted,ws(1),s.render(s.duration(),!0,!0),Pt=rt(y.a)-Xt+de+te,ai=Math.abs(de-Pt)>1,K&&ai&&Gt.splice(Gt.length-2,2),s.render(0,!0,!0),Js||s.invalidate(!0),s.parent||s.totalTime(s.totalTime()),ws(0)):Pt=de,_t&&(_t.value?_t.style["overflow"+y.a.toUpperCase()]=_t.value:_t.style.removeProperty("overflow-"+y.a));else if(f&&he()&&!b)for(Se=f.parentNode;Se&&Se!==Z;)Se._pinOffset&&(W-=Se._pinOffset,le-=Se._pinOffset),Se=Se.parentNode;vi&&vi.forEach(function(Pi){return Pi.revert(!1,!0)}),l.start=W,l.end=le,Ne=ct=Le?ht:he(),!b&&!Le&&(Ne<ht&&he(ht),l.scroll.rec=0),l.revert(!1,!0),vt=ze(),ot&&(Ke=-1,ot.restart(!0)),Me=0,s&&H&&(s._initted||$t)&&s.progress()!==$t&&s.progress($t||0,!0).render(s.time(),!0,!0),(ke||Ce!==l.progress||b)&&(s&&!H&&s.totalProgress(b&&W<-.001&&!Ce?x.utils.normalize(W,le,0):Ce,!0),l.progress=ke||(Ne-W)/de===Ce?0:Ce),d&&g&&(be._pinOffset=Math.round(l.progress*Pt)),U&&U.invalidate(),isNaN(wi)||(wi-=x.getProperty(c,y.p),Wi-=x.getProperty(He,y.p),Ji(c,y,wi),Ji(Be,y,wi-(F||0)),Ji(He,y,Wi),Ji(Xe,y,Wi-(F||0))),ke&&!Le&&l.update(),p&&!Le&&!Bt&&(Bt=!0,p(l),Bt=!1)}},l.getVelocity=function(){return(he()-ct)/(ze()-ss)*1e3||0},l.endAnimation=function(){Ri(l.callbackAnimation),s&&(U?U.progress(1):s.paused()?H||Ri(s,l.direction<0,1):Ri(s,s.reversed()))},l.labelToScroll=function(m){return s&&s.labels&&(W||l.refresh()||W)+s.labels[m]/s.duration()*de||0},l.getTrailing=function(m){var I=D.indexOf(l),T=l.direction>0?D.slice(0,I).reverse():D.slice(I+1);return(Qe(m)?T.filter(function(F){return F.vars.preventOverlaps===m}):T).filter(function(F){return l.direction>0?F.end<=W:F.start>=le})},l.update=function(m,I,T){if(!(b&&!T&&!m)){var F=Le===!0?ht:l.scroll(),me=m?0:(F-W)/de,N=me<0?0:me>1?1:me||0,oe=l.progress,ke,ve,te,$,lt,ie,Ye,pt;if(I&&(ct=Ne,Ne=b?he():F,v&&(Ft=Dt,Dt=s&&!H?s.totalProgress():N)),S&&!N&&d&&!Me&&!Yi&&st&&W<F+(F-ct)/(ze()-ss)*S&&(N=1e-4),N!==oe&&l.enabled){if(ke=l.isActive=!!N&&N<1,ve=!!oe&&oe<1,ie=ke!==ve,lt=ie||!!N!=!!oe,l.direction=N>oe?1:-1,l.progress=N,lt&&!Me&&(te=N&&!oe?0:N===1?1:oe===1?2:3,H&&($=!ie&&X[te+1]!=="none"&&X[te+1]||X[te],pt=s&&($==="complete"||$==="reset"||$ in s))),Q&&(ie||pt)&&(pt||_||!s)&&(Ie(Q)?Q(l):l.getTrailing(Q).forEach(function(qt){return qt.endAnimation()})),H||(U&&!Me&&!Yi?(U._dp._time-U._start!==U._time&&U.render(U._dp._time-U._start),U.resetTo?U.resetTo("totalProgress",N,s._tTime/s._tDur):(U.vars.totalProgress=N,U.invalidate().restart())):s&&s.totalProgress(N,!!(Me&&(vt||m)))),d){if(m&&g&&(be.style[g+y.os2]=ft),!K)nt(Ei(Xt+Pt*N));else if(lt){if(Ye=!m&&N>oe&&le+1>F&&F+1>=Et(w,y),j)if(!m&&(ke||Ye)){var je=Rt(d,!0),we=F-W;_r(d,Z,je.top+(y===ge?we:0)+Pe,je.left+(y===ge?0:we)+Pe)}else _r(d,be);xi(ke||Ye?Gt:bi),ai&&N<1&&ke||nt(Xt+(N===1&&!Ye?Pt:0))}}v&&!Ae.tween&&!Me&&!Yi&&ot.restart(!0),a&&(ie||B&&N&&(N<1||!Ps))&&cs(a.targets).forEach(function(qt){return qt.classList[ke||B?"add":"remove"](a.className)}),n&&!H&&!m&&n(l),lt&&!Me?(H&&(pt&&($==="complete"?s.pause().totalProgress(1):$==="reset"?s.restart(!0).pause():$==="restart"?s.restart(!0):s[$]()),n&&n(l)),(ie||!Ps)&&(u&&ie&&Rs(l,u),k[te]&&Rs(l,k[te]),B&&(N===1?l.kill(!1,1):k[te]=0),ie||(te=N===1?1:3,k[te]&&Rs(l,k[te]))),q&&!ke&&Math.abs(l.getVelocity())>(rs(q)?q:2500)&&(Ri(l.callbackAnimation),U?U.progress(1):Ri(s,$==="reverse"?1:!N,1))):H&&n&&!Me&&n(l)}if(oi){var Se=b?F/b.duration()*(b._caScrollDist||0):F;Ht(Se+(c._isFlipped?1:0)),oi(Se)}hi&&hi(-F/b.duration()*(b._caScrollDist||0))}},l.enable=function(m,I){l.enabled||(l.enabled=!0,ye(w,"resize",Mi),Y||ye(w,"scroll",di),fe&&ye(o,"refreshInit",fe),m!==!1&&(l.progress=Ce=0,Ne=ct=Ke=he()),I!==!1&&l.refresh())},l.getTween=function(m){return m&&Ae?Ae.tween:U},l.setPositions=function(m,I,T,F){if(b){var me=b.scrollTrigger,N=b.duration(),oe=me.end-me.start;m=me.start+oe*m/N,I=me.start+oe*I/N}l.refresh(!1,!1,{start:hr(m,T&&!!l._startClamp),end:hr(I,T&&!!l._endClamp)},F),l.update()},l.adjustPinSpacing=function(m){if(We&&m){var I=We.indexOf(y.d)+1;We[I]=parseFloat(We[I])+m+Pe,We[1]=parseFloat(We[1])+m+Pe,xi(We)}},l.disable=function(m,I){if(l.enabled&&(m!==!1&&l.revert(!0,!0),l.enabled=l.isActive=!1,I||U&&U.pause(),ht=0,Re&&(Re.uncache=1),fe&&xe(o,"refreshInit",fe),ot&&(ot.pause(),Ae.tween&&Ae.tween.kill()&&(Ae.tween=0)),!Y)){for(var T=D.length;T--;)if(D[T].scroller===w&&D[T]!==l)return;xe(w,"resize",Mi),Y||xe(w,"scroll",di)}},l.kill=function(m,I){l.disable(m,I),U&&!I&&U.kill(),h&&delete Us[h];var T=D.indexOf(l);T>=0&&D.splice(T,1),T===Oe&&os>0&&Oe--,T=0,D.forEach(function(F){return F.scroller===l.scroller&&(T=1)}),T||Le||(l.scroll.rec=0),s&&(s.scrollTrigger=null,m&&s.revert({kill:!1}),I||s.kill()),Be&&[Be,Xe,c,He].forEach(function(F){return F.parentNode&&F.parentNode.removeChild(F)}),Vi===l&&(Vi=0),d&&(Re&&(Re.uncache=1),T=0,D.forEach(function(F){return F.pin===d&&T++}),T||(Re.spacer=0)),i.onKill&&i.onKill(l)},D.push(l),l.enable(!1,!1),Tt&&Tt(l),s&&s.add&&!de){var ne=l.update;l.update=function(){l.update=ne,W||le||l.refresh()},x.delayedCall(.01,l.update),de=.01,W=le=0}else l.refresh();d&&Cn()},o.register=function(i){return ci||(x=i||Hr(),Xr()&&window.document&&o.enable(),ci=Si),ci},o.defaults=function(i){if(i)for(var s in i)Qi[s]=i[s];return Qi},o.disable=function(i,s){Si=0,D.forEach(function(n){return n[s?"kill":"disable"](i)}),xe(V,"wheel",di),xe(se,"scroll",di),clearInterval(Hi),xe(se,"touchcancel",xt),xe(Z,"touchstart",xt),$i(xe,se,"pointerdown,touchstart,mousedown",lr),$i(xe,se,"pointerup,touchend,mouseup",dr),us.kill(),ji(xe);for(var r=0;r<O.length;r+=3)qi(xe,O[r],O[r+1]),qi(xe,O[r],O[r+2])},o.enable=function(){if(V=window,se=document,ut=se.documentElement,Z=se.body,x&&(cs=x.utils.toArray,gi=x.utils.clamp,Vs=x.core.context||xt,ws=x.core.suppressOverwrites||xt,Xs=V.history.scrollRestoration||"auto",Ns=V.pageYOffset,x.core.globals("ScrollTrigger",o),Z)){Si=1,mi=document.createElement("div"),mi.style.height="100vh",mi.style.position="absolute",en(),wn(),ce.register(x),o.isTouch=ce.isTouch,Ot=ce.isTouch&&/(iPad|iPhone|iPod|Mac)/g.test(navigator.userAgent),ye(V,"wheel",di),Ir=[V,se,ut,Z],x.matchMedia?(o.matchMedia=function(h){var u=x.matchMedia(),p;for(p in h)u.add(p,h[p]);return u},x.addEventListener("matchMediaInit",function(){return Qs()}),x.addEventListener("matchMediaRevert",function(){return Kr()}),x.addEventListener("matchMedia",function(){Jt(0,1),ni("matchMedia")}),x.matchMedia("(orientation: portrait)",function(){return Ss(),Ss})):console.warn("Requires GSAP 3.11.0 or later"),Ss(),ye(se,"scroll",di);var i=Z.style,s=i.borderTopStyle,r=x.core.Animation.prototype,n,a;for(r.revert||Object.defineProperty(r,"revert",{value:function(){return this.time(-.01,!0)}}),i.borderTopStyle="solid",n=Rt(Z),ge.m=Math.round(n.top+ge.sc())||0,Ve.m=Math.round(n.left+Ve.sc())||0,s?i.borderTopStyle=s:i.removeProperty("border-top-style"),Hi=setInterval(fr,250),x.delayedCall(.5,function(){return Yi=0}),ye(se,"touchcancel",xt),ye(Z,"touchstart",xt),$i(ye,se,"pointerdown,touchstart,mousedown",lr),$i(ye,se,"pointerup,touchend,mouseup",dr),zs=x.utils.checkPrefix("transform"),hs.push(zs),ci=ze(),us=x.delayedCall(.2,Jt).pause(),fi=[se,"visibilitychange",function(){var h=V.innerWidth,u=V.innerHeight;se.hidden?(nr=h,ar=u):(nr!==h||ar!==u)&&Mi()},se,"DOMContentLoaded",Jt,V,"load",Jt,V,"resize",Mi],ji(ye),D.forEach(function(h){return h.enable(0,1)}),a=0;a<O.length;a+=3)qi(xe,O[a],O[a+1]),qi(xe,O[a],O[a+2])}},o.config=function(i){"limitCallbacks"in i&&(Ps=!!i.limitCallbacks);var s=i.syncInterval;s&&clearInterval(Hi)||(Hi=s)&&setInterval(fr,s),"ignoreMobileResize"in i&&(Br=o.isTouch===1&&i.ignoreMobileResize),"autoRefreshEvents"in i&&(ji(xe)||ji(ye,i.autoRefreshEvents||"none"),Nr=(i.autoRefreshEvents+"").indexOf("resize")===-1)},o.scrollerProxy=function(i,s){var r=Ge(i),n=O.indexOf(r),a=si(r);~n&&O.splice(n,a?6:2),s&&(a?yt.unshift(V,s,Z,s,ut,s):yt.unshift(r,s))},o.clearMatchMedia=function(i){D.forEach(function(s){return s._ctx&&s._ctx.query===i&&s._ctx.kill(!0,!0)})},o.isInViewport=function(i,s,r){var n=(Qe(i)?Ge(i):i).getBoundingClientRect(),a=n[r?ei:ti]*s||0;return r?n.right-a>0&&n.left+a<V.innerWidth:n.bottom-a>0&&n.top+a<V.innerHeight},o.positionInViewport=function(i,s,r){Qe(i)&&(i=Ge(i));var n=i.getBoundingClientRect(),a=n[r?ei:ti],h=s==null?a/2:s in fs?fs[s]*a:~s.indexOf("%")?parseFloat(s)*a/100:parseFloat(s)||0;return r?(n.left+h)/V.innerWidth:(n.top+h)/V.innerHeight},o.killAll=function(i){if(D.slice(0).forEach(function(r){return r.vars.id!=="ScrollSmoother"&&r.kill()}),i!==!0){var s=ri.killAll||[];ri={},s.forEach(function(r){return r()})}},o}();L.version="3.12.2";L.saveStyles=function(o){return o?cs(o).forEach(function(e){if(e&&e.style){var t=qe.indexOf(e);t>=0&&qe.splice(t,5),qe.push(e,e.style.cssText,e.getBBox&&e.getAttribute("transform"),x.core.getCache(e),Vs())}}):qe};L.revert=function(o,e){return Qs(!o,e)};L.create=function(o,e){return new L(o,e)};L.refresh=function(o){return o?Mi():(ci||L.register())&&Jt(!0)};L.update=function(o){return++O.cache&&Mt(o===!0?2:0)};L.clearScrollMemory=Jr;L.maxScroll=function(o,e){return Et(o,e?Ve:ge)};L.getScrollFunc=function(o,e){return Ut(Ge(o),e?Ve:ge)};L.getById=function(o){return Us[o]};L.getAll=function(){return D.filter(function(o){return o.vars.id!=="ScrollSmoother"})};L.isScrolling=function(){return!!st};L.snapDirectional=qs;L.addEventListener=function(o,e){var t=ri[o]||(ri[o]=[]);~t.indexOf(e)||t.push(e)};L.removeEventListener=function(o,e){var t=ri[o],i=t&&t.indexOf(e);i>=0&&t.splice(i,1)};L.batch=function(o,e){var t=[],i={},s=e.interval||.016,r=e.batchMax||1e9,n=function(u,p){var _=[],f=[],d=x.delayedCall(s,function(){p(_,f),_=[],f=[]}).pause();return function(g){_.length||d.restart(!0),_.push(g.trigger),f.push(g),r<=_.length&&d.progress(1)}},a;for(a in e)i[a]=a.substr(0,2)==="on"&&Ie(e[a])&&a!=="onRefreshInit"?n(a,e[a]):e[a];return Ie(r)&&(r=r(),ye(L,"refresh",function(){return r=e.batchMax()})),cs(o).forEach(function(h){var u={};for(a in i)u[a]=i[a];u.trigger=h,t.push(L.create(u))}),t};var xr=function(e,t,i,s){return t>s?e(s):t<0&&e(0),i>s?(s-t)/(i-t):i<0?t/(t-i):1},Ms=function o(e,t){t===!0?e.style.removeProperty("touch-action"):e.style.touchAction=t===!0?"auto":t?"pan-"+t+(ce.isTouch?" pinch-zoom":""):"none",e===ut&&o(Z,t)},es={auto:1,scroll:1},On=function(e){var t=e.event,i=e.target,s=e.axis,r=(t.changedTouches?t.changedTouches[0]:t).target,n=r._gsap||x.core.getCache(r),a=ze(),h;if(!n._isScrollT||a-n._isScrollT>2e3){for(;r&&r!==Z&&(r.scrollHeight<=r.clientHeight&&r.scrollWidth<=r.clientWidth||!(es[(h=it(r)).overflowY]||es[h.overflowX]));)r=r.parentNode;n._isScroll=r&&r!==i&&!si(r)&&(es[(h=it(r)).overflowY]||es[h.overflowX]),n._isScrollT=a}(n._isScroll||s==="x")&&(t.stopPropagation(),t._gsapAllow=!0)},sn=function(e,t,i,s){return ce.create({target:e,capture:!0,debounce:!1,lockAxis:!0,type:t,onWheel:s=s&&On,onPress:s,onDrag:s,onScroll:s,onEnable:function(){return i&&ye(se,ce.eventTypes[0],br,!1,!0)},onDisable:function(){return xe(se,ce.eventTypes[0],br,!0)}})},Ln=/(input|label|select|textarea)/i,yr,br=function(e){var t=Ln.test(e.target.tagName);(t||yr)&&(e._gsapAllow=!0,yr=t)},zn=function(e){Zt(e)||(e={}),e.preventDefault=e.isNormalizer=e.allowClicks=!0,e.type||(e.type="wheel,touch"),e.debounce=!!e.debounce,e.id=e.id||"normalizer";var t=e,i=t.normalizeScrollX,s=t.momentum,r=t.allowNestedScroll,n=t.onRelease,a,h,u=Ge(e.target)||ut,p=x.core.globals().ScrollSmoother,_=p&&p.get(),f=Ot&&(e.content&&Ge(e.content)||_&&e.content!==!1&&!_.smooth()&&_.content()),d=Ut(u,ge),g=Ut(u,Ve),C=1,S=(ce.isTouch&&V.visualViewport?V.visualViewport.scale*V.visualViewport.width:V.outerWidth)/V.innerWidth,z=0,E=Ie(s)?function(){return s(a)}:function(){return s||2.8},B,v,j=sn(u,e.type,!0,r),A=function(){return v=!1},b=xt,q=xt,Q=function(){h=Et(u,ge),q=gi(Ot?1:0,h),i&&(b=gi(0,Et(u,Ve))),B=ii},y=function(){f._gsap.y=Ei(parseFloat(f._gsap.y)+d.offset)+"px",f.style.transform="matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, "+parseFloat(f._gsap.y)+", 0, 1)",d.offset=d.cacheID=0},H=function(){if(v){requestAnimationFrame(A);var J=Ei(a.deltaY/2),ee=q(d.v-J);if(f&&ee!==d.v+d.offset){d.offset=ee-d.v;var l=Ei((parseFloat(f&&f._gsap.y)||0)-d.offset);f.style.transform="matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, "+l+", 0, 1)",f._gsap.y=l+"px",d.cacheID=O.cache,Mt()}return!0}d.offset&&y(),v=!0},w,_e,Y,K,k=function(){Q(),w.isActive()&&w.vars.scrollY>h&&(d()>h?w.progress(1)&&d(h):w.resetTo("scrollY",h))};return f&&x.set(f,{y:"+=0"}),e.ignoreCheck=function(X){return Ot&&X.type==="touchmove"&&H()||C>1.05&&X.type!=="touchstart"||a.isGesturing||X.touches&&X.touches.length>1},e.onPress=function(){v=!1;var X=C;C=Ei((V.visualViewport&&V.visualViewport.scale||1)/S),w.pause(),X!==C&&Ms(u,C>1.01?!0:i?!1:"x"),_e=g(),Y=d(),Q(),B=ii},e.onRelease=e.onGestureStart=function(X,J){if(d.offset&&y(),!J)K.restart(!0);else{O.cache++;var ee=E(),l,fe;i&&(l=g(),fe=l+ee*.05*-X.velocityX/.227,ee*=xr(g,l,fe,Et(u,Ve)),w.vars.scrollX=b(fe)),l=d(),fe=l+ee*.05*-X.velocityY/.227,ee*=xr(d,l,fe,Et(u,ge)),w.vars.scrollY=q(fe),w.invalidate().duration(ee).play(.01),(Ot&&w.vars.scrollY>=h||l>=h-1)&&x.to({},{onUpdate:k,duration:ee})}n&&n(X)},e.onWheel=function(){w._ts&&w.pause(),ze()-z>1e3&&(B=0,z=ze())},e.onChange=function(X,J,ee,l,fe){if(ii!==B&&Q(),J&&i&&g(b(l[2]===J?_e+(X.startX-X.x):g()+J-l[1])),ee){d.offset&&y();var Nt=fe[2]===ee,At=Nt?Y+X.startY-X.y:d()+ee-fe[1],Ke=q(At);Nt&&At!==Ke&&(Y+=Ke-At),d(Ke)}(ee||J)&&Mt()},e.onEnable=function(){Ms(u,i?!1:"x"),L.addEventListener("refresh",k),ye(V,"resize",k),d.smooth&&(d.target.style.scrollBehavior="auto",d.smooth=g.smooth=!1),j.enable()},e.onDisable=function(){Ms(u,!0),xe(V,"resize",k),L.removeEventListener("refresh",k),j.kill()},e.lockAxis=e.lockAxis!==!1,a=new ce(e),a.iOS=Ot,Ot&&!d()&&d(1),Ot&&x.ticker.add(xt),K=a._dc,w=x.to(a,{ease:"power4",paused:!0,scrollX:i?"+=0.1":"+=0",scrollY:"+=0.1",modifiers:{scrollY:tn(d,d(),function(){return w.pause()})},onUpdate:Mt,onComplete:K.vars.onComplete}),a};L.sort=function(o){return D.sort(o||function(e,t){return(e.vars.refreshPriority||0)*-1e6+e.start-(t.start+(t.vars.refreshPriority||0)*-1e6)})};L.observe=function(o){return new ce(o)};L.normalizeScroll=function(o){if(typeof o>"u")return $e;if(o===!0&&$e)return $e.enable();if(o===!1)return $e&&$e.kill();var e=o instanceof ce?o:zn(o);return $e&&$e.target===e.target&&$e.kill(),si(e.target)&&($e=e),e};L.core={_getVelocityProp:Ls,_inputObserver:sn,_scrollers:O,_proxies:yt,bridge:{ss:function(){st||ni("scrollStart"),st=ze()},ref:function(){return Me}}};Hr()&&x.registerPlugin(L);var Kt=er.registerPlugin(dn)||er;Kt.core.Tween;const Vn=`
precision mediump float;
`,_s=Vn.replace(/\n/g,""),In=`
attribute vec3 aVertexPosition;
attribute vec2 aTextureCoord;
`,rn=In.replace(/\n/g,""),Un=`
varying vec3 vVertexPosition;
varying vec2 vTextureCoord;
`,ms=Un.replace(/\n/g,""),Nn=_s+rn+ms+`
uniform mat4 uMVMatrix;
uniform mat4 uPMatrix;

void main() {
    vTextureCoord = aTextureCoord;
    vVertexPosition = aVertexPosition;
    
    gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);
}
`;Nn.replace(/\n/g,"");const Bn=_s+ms+`
void main() {
    gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);
}
`;Bn.replace(/\n/g,"");const Wn=_s+rn+ms+`
void main() {
    vTextureCoord = aTextureCoord;
    vVertexPosition = aVertexPosition;
    
    gl_Position = vec4(aVertexPosition, 1.0);
}
`;Wn.replace(/\n/g,"");const Gn=_s+ms+`
uniform sampler2D uRenderTexture;

void main() {
    gl_FragColor = texture2D(uRenderTexture, vTextureCoord);
}
`;Gn.replace(/\n/g,"");let Cs=class nn{constructor(e=0,t=e){this.type="Vec2",this._x=e,this._y=t}get x(){return this._x}get y(){return this._y}set x(e){const t=e!==this._x;this._x=e,t&&this._onChangeCallback&&this._onChangeCallback()}set y(e){const t=e!==this._y;this._y=e,t&&this._onChangeCallback&&this._onChangeCallback()}onChange(e){return e&&(this._onChangeCallback=e),this}set(e,t){return this._x=e,this._y=t,this}add(e){return this._x+=e.x,this._y+=e.y,this}addScalar(e){return this._x+=e,this._y+=e,this}sub(e){return this._x-=e.x,this._y-=e.y,this}subScalar(e){return this._x-=e,this._y-=e,this}multiply(e){return this._x*=e.x,this._y*=e.y,this}multiplyScalar(e){return this._x*=e,this._y*=e,this}copy(e){return this._x=e.x,this._y=e.y,this}clone(){return new nn(this._x,this._y)}sanitizeNaNValuesWith(e){return this._x=isNaN(this._x)?e.x:parseFloat(this._x),this._y=isNaN(this._y)?e.y:parseFloat(this._y),this}max(e){return this._x=Math.max(this._x,e.x),this._y=Math.max(this._y,e.y),this}min(e){return this._x=Math.min(this._x,e.x),this._y=Math.min(this._y,e.y),this}equals(e){return this._x===e.x&&this._y===e.y}normalize(){let e=this._x*this._x+this._y*this._y;return e>0&&(e=1/Math.sqrt(e)),this._x*=e,this._y*=e,this}dot(e){return this._x*e.x+this._y*e.y}},As=0;function R(){if(!(As>100)){if(As===100)console.warn("Curtains: too many warnings thrown, stop logging.");else{const o=Array.prototype.slice.call(arguments);console.warn.apply(console,o)}As++}}function Ue(){const o=Array.prototype.slice.call(arguments);console.error.apply(console,o)}function an(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,o=>{let e=Math.random()*16|0;return(o==="x"?e:e&3|8).toString(16).toUpperCase()})}function mt(o){return(o&o-1)===0}function Xn(o,e,t){return(1-t)*o+t*e}class Hn{constructor(e){if(this.type="Scene",!e||e.type!=="Renderer")Ue(this.type+": Renderer not passed as first argument",e);else if(!e.gl){Ue(this.type+": Renderer WebGL context is undefined",e);return}this.renderer=e,this.gl=e.gl,this.initStacks()}initStacks(){this.stacks={pingPong:[],renderTargets:[],opaque:[],transparent:[],renderPasses:[],scenePasses:[]}}resetPlaneStacks(){this.stacks.pingPong=[],this.stacks.renderTargets=[],this.stacks.opaque=[],this.stacks.transparent=[];for(let e=0;e<this.renderer.planes.length;e++)this.addPlane(this.renderer.planes[e])}resetShaderPassStacks(){this.stacks.scenePasses=[],this.stacks.renderPasses=[];for(let e=0;e<this.renderer.shaderPasses.length;e++)this.renderer.shaderPasses[e].index=e,this.renderer.shaderPasses[e]._isScenePass?this.stacks.scenePasses.push(this.renderer.shaderPasses[e]):this.stacks.renderPasses.push(this.renderer.shaderPasses[e]);this.stacks.scenePasses.length===0&&(this.renderer.state.scenePassIndex=null)}addToRenderTargetsStack(e){const t=this.renderer.planes.filter(s=>s.type!=="PingPongPlane"&&s.target&&s.uuid!==e.uuid);let i=-1;if(e.target._depth){for(let s=t.length-1;s>=0;s--)if(t[s].target.uuid===e.target.uuid){i=s+1;break}}else i=t.findIndex(s=>s.target.uuid===e.target.uuid);i=Math.max(0,i),t.splice(i,0,e),e.target._depth?(t.sort((s,r)=>s.index-r.index),t.sort((s,r)=>r.renderOrder-s.renderOrder)):(t.sort((s,r)=>r.index-s.index),t.sort((s,r)=>s.renderOrder-r.renderOrder)),t.sort((s,r)=>s.target.index-r.target.index),this.stacks.renderTargets=t}addToRegularPlaneStack(e){const t=this.renderer.planes.filter(s=>s.type!=="PingPongPlane"&&!s.target&&s._transparent===e._transparent&&s.uuid!==e.uuid);let i=-1;for(let s=t.length-1;s>=0;s--)if(t[s]._geometry.definition.id===e._geometry.definition.id){i=s+1;break}return i=Math.max(0,i),t.splice(i,0,e),t.sort((s,r)=>s.index-r.index),t}addPlane(e){if(e.type==="PingPongPlane")this.stacks.pingPong.push(e);else if(e.target)this.addToRenderTargetsStack(e);else if(e._transparent){const t=this.addToRegularPlaneStack(e);t.sort((i,s)=>s.relativeTranslation.z-i.relativeTranslation.z),t.sort((i,s)=>s.renderOrder-i.renderOrder),this.stacks.transparent=t}else{const t=this.addToRegularPlaneStack(e);t.sort((i,s)=>s.renderOrder-i.renderOrder),this.stacks.opaque=t}}removePlane(e){e.type==="PingPongPlane"?this.stacks.pingPong=this.stacks.pingPong.filter(t=>t.uuid!==e.uuid):e.target?this.stacks.renderTargets=this.stacks.renderTargets.filter(t=>t.uuid!==e.uuid):e._transparent?this.stacks.transparent=this.stacks.transparent.filter(t=>t.uuid!==e.uuid):this.stacks.opaque=this.stacks.opaque.filter(t=>t.uuid!==e.uuid)}setPlaneRenderOrder(e){if(e.type==="ShaderPass")this.sortShaderPassStack(e._isScenePass?this.stacks.scenePasses:this.stacks.renderPasses);else if(e.type==="PingPongPlane")return;if(e.target)e.target._depth?(this.stacks.renderTargets.sort((t,i)=>t.index-i.index),this.stacks.renderTargets.sort((t,i)=>i.renderOrder-t.renderOrder)):(this.stacks.renderTargets.sort((t,i)=>i.index-t.index),this.stacks.renderTargets.sort((t,i)=>t.renderOrder-i.renderOrder)),this.stacks.renderTargets.sort((t,i)=>t.target.index-i.target.index);else{const t=e._transparent?this.stacks.transparent:this.stacks.opaque,i=this.stacks.scenePasses.find((s,r)=>s._isScenePass&&!s._depth&&r===0);!this.renderer.depth||i?(t.sort((s,r)=>r.index-s.index),e._transparent&&t.sort((s,r)=>s.relativeTranslation.z-r.relativeTranslation.z),t.sort((s,r)=>s.renderOrder-r.renderOrder)):(t.sort((s,r)=>s.index-r.index),e._transparent&&t.sort((s,r)=>r.relativeTranslation.z-s.relativeTranslation.z),t.sort((s,r)=>r.renderOrder-s.renderOrder))}}addShaderPass(e){e._isScenePass?(this.stacks.scenePasses.push(e),this.sortShaderPassStack(this.stacks.scenePasses)):(this.stacks.renderPasses.push(e),this.sortShaderPassStack(this.stacks.renderPasses))}removeShaderPass(e){this.resetShaderPassStacks()}sortShaderPassStack(e){e.sort((t,i)=>t.index-i.index),e.sort((t,i)=>t.renderOrder-i.renderOrder)}enableShaderPass(){this.stacks.scenePasses.length&&this.stacks.renderPasses.length===0&&this.renderer.planes.length&&(this.renderer.state.scenePassIndex=0,this.renderer.bindFrameBuffer(this.stacks.scenePasses[0].target))}drawRenderPasses(){this.stacks.scenePasses.length&&this.stacks.renderPasses.length&&this.renderer.planes.length&&(this.renderer.state.scenePassIndex=0,this.renderer.bindFrameBuffer(this.stacks.scenePasses[0].target));for(let e=0;e<this.stacks.renderPasses.length;e++)this.stacks.renderPasses[e]._startDrawing(),this.renderer.clearDepth()}drawScenePasses(){for(let e=0;e<this.stacks.scenePasses.length;e++)this.stacks.scenePasses[e]._startDrawing()}drawPingPongStack(){for(let e=0;e<this.stacks.pingPong.length;e++){const t=this.stacks.pingPong[e];t&&t._startDrawing()}}drawStack(e){for(let t=0;t<this.stacks[e].length;t++){const i=this.stacks[e][t];i&&i._startDrawing()}}draw(){this.drawPingPongStack(),this.enableShaderPass(),this.drawStack("renderTargets"),this.drawRenderPasses(),this.renderer.setBlending(!1),this.drawStack("opaque"),this.stacks.transparent.length&&(this.renderer.setBlending(!0),this.drawStack("transparent")),this.drawScenePasses()}}class Yn{constructor(){this.geometries=[],this.clear()}clear(){this.textures=[],this.programs=[]}getGeometryFromID(e){return this.geometries.find(t=>t.id===e)}addGeometry(e,t,i){this.geometries.push({id:e,vertices:t,uvs:i})}isSameShader(e,t){return e.localeCompare(t)===0}getProgramFromShaders(e,t){return this.programs.find(i=>this.isSameShader(i.vsCode,e)&&this.isSameShader(i.fsCode,t))}addProgram(e){this.programs.push(e)}getTextureFromSource(e){const t=typeof e=="string"?e:e.src;return this.textures.find(i=>i.source&&i.source.src===t)}addTexture(e){this.getTextureFromSource(e.source)||this.textures.push(e)}removeTexture(e){this.textures=this.textures.filter(t=>t.uuid!==e.uuid)}}class jn{constructor(){this.clear()}clear(){this.queue=[]}add(e,t=!1){const i={callback:e,keep:t,timeout:null};return i.timeout=setTimeout(()=>{this.queue.push(i)},0),i}execute(){this.queue.map(e=>{e.callback&&e.callback(),clearTimeout(this.queue.timeout)}),this.queue=this.queue.filter(e=>e.keep)}}class $n{constructor({alpha:e,antialias:t,premultipliedAlpha:i,depth:s,failIfMajorPerformanceCaveat:r,preserveDrawingBuffer:n,stencil:a,container:h,pixelRatio:u,renderingScale:p,production:_,onError:f,onSuccess:d,onContextLost:g,onContextRestored:C,onDisposed:S,onSceneChange:z}){this.type="Renderer",this.alpha=e,this.antialias=t,this.premultipliedAlpha=i,this.depth=s,this.failIfMajorPerformanceCaveat=r,this.preserveDrawingBuffer=n,this.stencil=a,this.container=h,this.pixelRatio=u,this._renderingScale=p,this.production=_,this.onError=f,this.onSuccess=d,this.onContextLost=g,this.onContextRestored=C,this.onDisposed=S,this.onSceneChange=z,this.initState(),this.canvas=document.createElement("canvas");const E={alpha:this.alpha,premultipliedAlpha:this.premultipliedAlpha,antialias:this.antialias,depth:this.depth,failIfMajorPerformanceCaveat:this.failIfMajorPerformanceCaveat,preserveDrawingBuffer:this.preserveDrawingBuffer,stencil:this.stencil};if(this.gl=this.canvas.getContext("webgl2",E),this._isWebGL2=!!this.gl,this.gl||(this.gl=this.canvas.getContext("webgl",E)||this.canvas.getContext("experimental-webgl",E)),this.gl)this.onSuccess&&this.onSuccess();else{this.production||R(this.type+": WebGL context could not be created"),this.state.isActive=!1,this.onError&&this.onError();return}this.initRenderer()}initState(){this.state={isActive:!0,isContextLost:!0,drawingEnabled:!0,forceRender:!1,currentProgramID:null,currentGeometryID:null,forceBufferUpdate:!1,depthTest:null,blending:null,cullFace:null,frameBufferID:null,scenePassIndex:null,activeTexture:null,unpackAlignment:null,flipY:null,premultiplyAlpha:null}}initCallbackQueueManager(){this.nextRender=new jn}initRenderer(){this.planes=[],this.renderTargets=[],this.shaderPasses=[],this.state.isContextLost=!1,this.state.maxTextureSize=this.gl.getParameter(this.gl.MAX_TEXTURE_SIZE),this.initCallbackQueueManager(),this.setBlendFunc(),this.setDepthFunc(),this.setDepthTest(!0),this.cache=new Yn,this.scene=new Hn(this),this.getExtensions(),this._contextLostHandler=this.contextLost.bind(this),this.canvas.addEventListener("webglcontextlost",this._contextLostHandler,!1),this._contextRestoredHandler=this.contextRestored.bind(this),this.canvas.addEventListener("webglcontextrestored",this._contextRestoredHandler,!1)}getExtensions(){this.extensions=[],this._isWebGL2?(this.extensions.EXT_color_buffer_float=this.gl.getExtension("EXT_color_buffer_float"),this.extensions.OES_texture_float_linear=this.gl.getExtension("OES_texture_float_linear"),this.extensions.EXT_texture_filter_anisotropic=this.gl.getExtension("EXT_texture_filter_anisotropic"),this.extensions.WEBGL_lose_context=this.gl.getExtension("WEBGL_lose_context")):(this.extensions.OES_vertex_array_object=this.gl.getExtension("OES_vertex_array_object"),this.extensions.OES_texture_float=this.gl.getExtension("OES_texture_float"),this.extensions.OES_texture_float_linear=this.gl.getExtension("OES_texture_float_linear"),this.extensions.OES_texture_half_float=this.gl.getExtension("OES_texture_half_float"),this.extensions.OES_texture_half_float_linear=this.gl.getExtension("OES_texture_half_float_linear"),this.extensions.EXT_texture_filter_anisotropic=this.gl.getExtension("EXT_texture_filter_anisotropic"),this.extensions.OES_element_index_uint=this.gl.getExtension("OES_element_index_uint"),this.extensions.OES_standard_derivatives=this.gl.getExtension("OES_standard_derivatives"),this.extensions.EXT_sRGB=this.gl.getExtension("EXT_sRGB"),this.extensions.WEBGL_depth_texture=this.gl.getExtension("WEBGL_depth_texture"),this.extensions.WEBGL_draw_buffers=this.gl.getExtension("WEBGL_draw_buffers"),this.extensions.WEBGL_lose_context=this.gl.getExtension("WEBGL_lose_context"))}contextLost(e){this.state.isContextLost=!0,this.state.isActive&&(e.preventDefault(),this.nextRender.add(()=>this.onContextLost&&this.onContextLost()))}restoreContext(){this.state.isActive&&(this.initState(),this.gl&&this.extensions.WEBGL_lose_context?this.extensions.WEBGL_lose_context.restoreContext():(!this.gl&&!this.production?R(this.type+": Could not restore the context because the context is not defined"):!this.extensions.WEBGL_lose_context&&!this.production&&R(this.type+": Could not restore the context because the restore context extension is not defined"),this.onError&&this.onError()))}isContextexFullyRestored(){let e=!0;for(let t=0;t<this.renderTargets.length;t++){this.renderTargets[t].textures[0]._canDraw||(e=!1);break}if(e)for(let t=0;t<this.planes.length;t++)if(this.planes[t]._canDraw){for(let i=0;i<this.planes[t].textures.length;i++)if(!this.planes[t].textures[i]._canDraw){e=!1;break}}else{e=!1;break}if(e)for(let t=0;t<this.shaderPasses.length;t++)if(this.shaderPasses[t]._canDraw){for(let i=0;i<this.shaderPasses[t].textures.length;i++)if(!this.shaderPasses[t].textures[i]._canDraw){e=!1;break}}else{e=!1;break}return e}contextRestored(){this.getExtensions(),this.setBlendFunc(),this.setDepthFunc(),this.setDepthTest(!0),this.cache.clear(),this.scene.initStacks();for(let t=0;t<this.renderTargets.length;t++)this.renderTargets[t]._restoreContext();for(let t=0;t<this.planes.length;t++)this.planes[t]._restoreContext();for(let t=0;t<this.shaderPasses.length;t++)this.shaderPasses[t]._restoreContext();const e=this.nextRender.add(()=>{this.isContextexFullyRestored()&&(e.keep=!1,this.state.isContextLost=!1,this.onContextRestored&&this.onContextRestored(),this.onSceneChange(),this.needRender())},!0)}setPixelRatio(e){this.pixelRatio=e}setSize(){if(!this.gl)return;const e=this.container.getBoundingClientRect();this._boundingRect={width:e.width*this.pixelRatio,height:e.height*this.pixelRatio,top:e.top*this.pixelRatio,left:e.left*this.pixelRatio};const t=!!navigator.userAgent.match(/Version\/[\d\.]+.*Safari/),i=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream;if(t&&i){let s=function(r){let n=0;for(;r&&!isNaN(r.offsetTop);)n+=r.offsetTop-r.scrollTop,r=r.offsetParent;return n};this._boundingRect.top=s(this.container)*this.pixelRatio}this.canvas.style.width=Math.floor(this._boundingRect.width/this.pixelRatio)+"px",this.canvas.style.height=Math.floor(this._boundingRect.height/this.pixelRatio)+"px",this.canvas.width=Math.floor(this._boundingRect.width*this._renderingScale),this.canvas.height=Math.floor(this._boundingRect.height*this._renderingScale),this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight)}resize(){for(let e=0;e<this.planes.length;e++)this.planes[e]._canDraw&&this.planes[e].resize();for(let e=0;e<this.shaderPasses.length;e++)this.shaderPasses[e]._canDraw&&this.shaderPasses[e].resize();for(let e=0;e<this.renderTargets.length;e++)this.renderTargets[e].resize();this.needRender()}clear(){this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT)}clearDepth(){this.gl.clear(this.gl.DEPTH_BUFFER_BIT)}clearColor(){this.gl.clear(this.gl.COLOR_BUFFER_BIT)}bindFrameBuffer(e,t){let i=null;e?(i=e.index,i!==this.state.frameBufferID&&(this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,e._frameBuffer),this.gl.viewport(0,0,e._size.width,e._size.height),e._shouldClear&&!t&&this.clear())):this.state.frameBufferID!==null&&(this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight)),this.state.frameBufferID=i}setDepthTest(e){e&&!this.state.depthTest?(this.state.depthTest=e,this.gl.enable(this.gl.DEPTH_TEST)):!e&&this.state.depthTest&&(this.state.depthTest=e,this.gl.disable(this.gl.DEPTH_TEST))}setDepthFunc(){this.gl.depthFunc(this.gl.LEQUAL)}setBlending(e=!1){e&&!this.state.blending?(this.state.blending=e,this.gl.enable(this.gl.BLEND)):!e&&this.state.blending&&(this.state.blending=e,this.gl.disable(this.gl.BLEND))}setBlendFunc(){this.gl.enable(this.gl.BLEND),this.premultipliedAlpha?this.gl.blendFuncSeparate(this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA,this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA):this.gl.blendFuncSeparate(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA,this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA)}setFaceCulling(e){if(this.state.cullFace!==e)if(this.state.cullFace=e,e==="none")this.gl.disable(this.gl.CULL_FACE);else{const t=e==="front"?this.gl.FRONT:this.gl.BACK;this.gl.enable(this.gl.CULL_FACE),this.gl.cullFace(t)}}useProgram(e){(this.state.currentProgramID===null||this.state.currentProgramID!==e.id)&&(this.gl.useProgram(e.program),this.state.currentProgramID=e.id)}removePlane(e){this.gl&&(this.planes=this.planes.filter(t=>t.uuid!==e.uuid),this.scene.removePlane(e),e=null,this.gl&&this.clear(),this.onSceneChange())}removeRenderTarget(e){if(!this.gl)return;let t=this.planes.find(i=>i.type!=="PingPongPlane"&&i.target&&i.target.uuid===e.uuid);for(let i=0;i<this.planes.length;i++)this.planes[i].target&&this.planes[i].target.uuid===e.uuid&&(this.planes[i].target=null);this.renderTargets=this.renderTargets.filter(i=>i.uuid!==e.uuid);for(let i=0;i<this.renderTargets.length;i++)this.renderTargets[i].index=i;e=null,this.gl&&this.clear(),t&&this.scene.resetPlaneStacks(),this.onSceneChange()}removeShaderPass(e){this.gl&&(this.shaderPasses=this.shaderPasses.filter(t=>t.uuid!==e.uuid),this.scene.removeShaderPass(e),e=null,this.gl&&this.clear(),this.onSceneChange())}enableDrawing(){this.state.drawingEnabled=!0}disableDrawing(){this.state.drawingEnabled=!1}needRender(){this.state.forceRender=!0}render(){this.gl&&(this.clear(),this.state.currentGeometryID=null,this.scene.draw())}deletePrograms(){for(let e=0;e<this.cache.programs.length;e++){const t=this.cache.programs[e];this.gl.deleteProgram(t.program)}}dispose(){if(!this.gl)return;for(this.state.isActive=!1;this.planes.length>0;)this.removePlane(this.planes[0]);for(;this.shaderPasses.length>0;)this.removeShaderPass(this.shaderPasses[0]);for(;this.renderTargets.length>0;)this.removeRenderTarget(this.renderTargets[0]);let e=this.nextRender.add(()=>{this.planes.length===0&&this.shaderPasses.length===0&&this.renderTargets.length===0&&(e.keep=!1,this.deletePrograms(),this.clear(),this.canvas.removeEventListener("webgllost",this._contextLostHandler,!1),this.canvas.removeEventListener("webglrestored",this._contextRestoredHandler,!1),this.gl&&this.extensions.WEBGL_lose_context&&this.extensions.WEBGL_lose_context.loseContext(),this.canvas.width=this.canvas.width,this.gl=null,this.container.removeChild(this.canvas),this.container=null,this.canvas=null,this.onDisposed&&this.onDisposed())},!0)}}class qn{constructor({xOffset:e=0,yOffset:t=0,lastXDelta:i=0,lastYDelta:s=0,shouldWatch:r=!0,onScroll:n=()=>{}}={}){this.xOffset=e,this.yOffset=t,this.lastXDelta=i,this.lastYDelta=s,this.shouldWatch=r,this.onScroll=n,this.handler=this.scroll.bind(this,!0),this.shouldWatch&&window.addEventListener("scroll",this.handler,{passive:!0})}scroll(){this.updateScrollValues(window.pageXOffset,window.pageYOffset)}updateScrollValues(e,t){const i=this.xOffset;this.xOffset=e,this.lastXDelta=i-this.xOffset;const s=this.yOffset;this.yOffset=t,this.lastYDelta=s-this.yOffset,this.onScroll&&this.onScroll(this.lastXDelta,this.lastYDelta)}dispose(){this.shouldWatch&&window.removeEventListener("scroll",this.handler,{passive:!0})}}const Qn="8.1.3";class Zn{constructor({container:e,alpha:t=!0,premultipliedAlpha:i=!1,antialias:s=!0,depth:r=!0,failIfMajorPerformanceCaveat:n=!0,preserveDrawingBuffer:a=!1,stencil:h=!1,autoResize:u=!0,autoRender:p=!0,watchScroll:_=!0,pixelRatio:f=window.devicePixelRatio||1,renderingScale:d=1,production:g=!1}={}){this.type="Curtains",this._autoResize=u,this._autoRender=p,this._watchScroll=_,this.pixelRatio=f,d=isNaN(d)?1:parseFloat(d),this._renderingScale=Math.max(.25,Math.min(1,d)),this.premultipliedAlpha=i,this.alpha=t,this.antialias=s,this.depth=r,this.failIfMajorPerformanceCaveat=n,this.preserveDrawingBuffer=a,this.stencil=h,this.production=g,this.errors=!1,e?this.setContainer(e):this.production||R(this.type+": no container provided in the initial parameters. Use setContainer() method to set one later and initialize the WebGL context")}setContainer(e){if(e)if(typeof e=="string")if(e=document.getElementById(e),e)this.container=e;else{let t=document.createElement("div");t.setAttribute("id","curtains-canvas"),document.body.appendChild(t),this.container=t,this.production||R('Curtains: no valid container HTML element or ID provided, created a div with "curtains-canvas" ID instead')}else e instanceof Element&&(this.container=e);else{let t=document.createElement("div");t.setAttribute("id","curtains-canvas"),document.body.appendChild(t),this.container=t,this.production||R('Curtains: no valid container HTML element or ID provided, created a div with "curtains-canvas" ID instead')}this._initCurtains()}_initCurtains(){this.planes=[],this.renderTargets=[],this.shaderPasses=[],this._initRenderer(),this.gl&&(this._initScroll(),this._setSize(),this._addListeners(),this.container.appendChild(this.canvas),console.log("curtains.js - v"+Qn),this._animationFrameID=null,this._autoRender&&this._animate())}_initRenderer(){this.renderer=new $n({alpha:this.alpha,antialias:this.antialias,premultipliedAlpha:this.premultipliedAlpha,depth:this.depth,failIfMajorPerformanceCaveat:this.failIfMajorPerformanceCaveat,preserveDrawingBuffer:this.preserveDrawingBuffer,stencil:this.stencil,container:this.container,pixelRatio:this.pixelRatio,renderingScale:this._renderingScale,production:this.production,onError:()=>this._onRendererError(),onSuccess:()=>this._onRendererSuccess(),onContextLost:()=>this._onRendererContextLost(),onContextRestored:()=>this._onRendererContextRestored(),onDisposed:()=>this._onRendererDisposed(),onSceneChange:()=>this._keepSync()}),this.gl=this.renderer.gl,this.canvas=this.renderer.canvas}restoreContext(){this.renderer.restoreContext()}_animate(){this.render(),this._animationFrameID=window.requestAnimationFrame(this._animate.bind(this))}enableDrawing(){this.renderer.enableDrawing()}disableDrawing(){this.renderer.disableDrawing()}needRender(){this.renderer.needRender()}nextRender(e,t=!1){return this.renderer.nextRender.add(e,t)}clear(){this.renderer&&this.renderer.clear()}clearDepth(){this.renderer&&this.renderer.clearDepth()}clearColor(){this.renderer&&this.renderer.clearColor()}isWebGL2(){return this.gl?this.renderer._isWebGL2:!1}render(){this.renderer.nextRender.execute(),!(!this.renderer.state.drawingEnabled&&!this.renderer.state.forceRender)&&(this.renderer.state.forceRender&&(this.renderer.state.forceRender=!1),this._onRenderCallback&&this._onRenderCallback(),this.renderer.render())}_addListeners(){this._resizeHandler=null,this._autoResize&&(this._resizeHandler=this.resize.bind(this,!0),window.addEventListener("resize",this._resizeHandler,!1))}setPixelRatio(e,t){this.pixelRatio=parseFloat(Math.max(e,1))||1,this.renderer.setPixelRatio(e),this.resize(t)}_setSize(){this.renderer.setSize(),this._scrollManager.shouldWatch&&(this._scrollManager.xOffset=window.pageXOffset,this._scrollManager.yOffset=window.pageYOffset)}getBoundingRect(){return this.renderer._boundingRect}resize(e){this.gl&&(this._setSize(),this.renderer.resize(),this.nextRender(()=>{this._onAfterResizeCallback&&e&&this._onAfterResizeCallback()}))}_initScroll(){this._scrollManager=new qn({xOffset:window.pageXOffset,yOffset:window.pageYOffset,lastXDelta:0,lastYDelta:0,shouldWatch:this._watchScroll,onScroll:(e,t)=>this._updateScroll(e,t)})}_updateScroll(e,t){for(let i=0;i<this.planes.length;i++)this.planes[i].watchScroll&&this.planes[i].updateScrollPosition(e,t);this.renderer.needRender(),this._onScrollCallback&&this._onScrollCallback()}updateScrollValues(e,t){this._scrollManager.updateScrollValues(e,t)}getScrollDeltas(){return{x:this._scrollManager.lastXDelta,y:this._scrollManager.lastYDelta}}getScrollValues(){return{x:this._scrollManager.xOffset,y:this._scrollManager.yOffset}}_keepSync(){this.planes=this.renderer.planes,this.shaderPasses=this.renderer.shaderPasses,this.renderTargets=this.renderer.renderTargets}lerp(e,t,i){return Xn(e,t,i)}onAfterResize(e){return e&&(this._onAfterResizeCallback=e),this}onError(e){return e&&(this._onErrorCallback=e),this}_onRendererError(){setTimeout(()=>{this._onErrorCallback&&!this.errors&&this._onErrorCallback(),this.errors=!0},0)}onSuccess(e){return e&&(this._onSuccessCallback=e),this}_onRendererSuccess(){setTimeout(()=>{this._onSuccessCallback&&this._onSuccessCallback()},0)}onContextLost(e){return e&&(this._onContextLostCallback=e),this}_onRendererContextLost(){this._onContextLostCallback&&this._onContextLostCallback()}onContextRestored(e){return e&&(this._onContextRestoredCallback=e),this}_onRendererContextRestored(){this._onContextRestoredCallback&&this._onContextRestoredCallback()}onRender(e){return e&&(this._onRenderCallback=e),this}onScroll(e){return e&&(this._onScrollCallback=e),this}dispose(){this.renderer.dispose()}_onRendererDisposed(){this._animationFrameID&&window.cancelAnimationFrame(this._animationFrameID),this._resizeHandler&&window.removeEventListener("resize",this._resizeHandler,!1),this._scrollManager&&this._scrollManager.dispose()}}class Kn{constructor(e,t,i){if(this.type="Uniforms",!e||e.type!=="Renderer")Ue(this.type+": Renderer not passed as first argument",e);else if(!e.gl){Ue(this.type+": Renderer WebGL context is undefined",e);return}if(this.renderer=e,this.gl=e.gl,this.program=t,this.uniforms={},i)for(const s in i){const r=i[s];this.uniforms[s]={name:r.name,type:r.type,value:r.value.clone&&typeof r.value.clone=="function"?r.value.clone():r.value,update:null}}}handleUniformSetting(e){switch(e.type){case"1i":e.update=this.setUniform1i.bind(this);break;case"1iv":e.update=this.setUniform1iv.bind(this);break;case"1f":e.update=this.setUniform1f.bind(this);break;case"1fv":e.update=this.setUniform1fv.bind(this);break;case"2i":e.update=this.setUniform2i.bind(this);break;case"2iv":e.update=this.setUniform2iv.bind(this);break;case"2f":e.update=this.setUniform2f.bind(this);break;case"2fv":e.update=this.setUniform2fv.bind(this);break;case"3i":e.update=this.setUniform3i.bind(this);break;case"3iv":e.update=this.setUniform3iv.bind(this);break;case"3f":e.update=this.setUniform3f.bind(this);break;case"3fv":e.update=this.setUniform3fv.bind(this);break;case"4i":e.update=this.setUniform4i.bind(this);break;case"4iv":e.update=this.setUniform4iv.bind(this);break;case"4f":e.update=this.setUniform4f.bind(this);break;case"4fv":e.update=this.setUniform4fv.bind(this);break;case"mat2":e.update=this.setUniformMatrix2fv.bind(this);break;case"mat3":e.update=this.setUniformMatrix3fv.bind(this);break;case"mat4":e.update=this.setUniformMatrix4fv.bind(this);break;default:this.renderer.production||R(this.type+": This uniform type is not handled : ",e.type)}}setInternalFormat(e){e.value.type==="Vec2"?(e._internalFormat="Vec2",e.lastValue=e.value.clone()):e.value.type==="Vec3"?(e._internalFormat="Vec3",e.lastValue=e.value.clone()):e.value.type==="Mat4"?(e._internalFormat="Mat4",e.lastValue=e.value.clone()):e.value.type==="Quat"?(e._internalFormat="Quat",e.lastValue=e.value.clone()):Array.isArray(e.value)?(e._internalFormat="array",e.lastValue=Array.from(e.value)):e.value.constructor===Float32Array?(e._internalFormat="mat",e.lastValue=e.value):(e._internalFormat="float",e.lastValue=e.value)}setUniforms(){if(this.uniforms)for(const e in this.uniforms){let t=this.uniforms[e];t.location=this.gl.getUniformLocation(this.program,t.name),t._internalFormat||this.setInternalFormat(t),t.type||(t._internalFormat==="Vec2"?t.type="2f":t._internalFormat==="Vec3"?t.type="3f":t._internalFormat==="Mat4"?t.type="mat4":t._internalFormat==="array"?t.value.length===4?(t.type="4f",this.renderer.production||R(this.type+": No uniform type declared for "+t.name+", applied a 4f (array of 4 floats) uniform type")):t.value.length===3?(t.type="3f",this.renderer.production||R(this.type+": No uniform type declared for "+t.name+", applied a 3f (array of 3 floats) uniform type")):t.value.length===2&&(t.type="2f",this.renderer.production||R(this.type+": No uniform type declared for "+t.name+", applied a 2f (array of 2 floats) uniform type")):t._internalFormat==="mat"?t.value.length===16?(t.type="mat4",this.renderer.production||R(this.type+": No uniform type declared for "+t.name+", applied a mat4 (4x4 matrix array) uniform type")):t.value.length===9?(t.type="mat3",this.renderer.production||R(this.type+": No uniform type declared for "+t.name+", applied a mat3 (3x3 matrix array) uniform type")):t.value.length===4&&(t.type="mat2",this.renderer.production||R(this.type+": No uniform type declared for "+t.name+", applied a mat2 (2x2 matrix array) uniform type")):(t.type="1f",this.renderer.production||R(this.type+": No uniform type declared for "+t.name+", applied a 1f (float) uniform type"))),this.handleUniformSetting(t),t.update&&t.update(t)}}updateUniforms(){if(this.uniforms)for(const e in this.uniforms){const t=this.uniforms[e];let i=!1;t._internalFormat==="Vec2"||t._internalFormat==="Vec3"||t._internalFormat==="Quat"?t.value.equals(t.lastValue)||(i=!0,t.lastValue.copy(t.value)):t.value.length?JSON.stringify(t.value)!==JSON.stringify(t.lastValue)&&(i=!0,t.lastValue=Array.from(t.value)):t.value!==t.lastValue&&(i=!0,t.lastValue=t.value),i&&t.update&&t.update(t)}}setUniform1i(e){this.gl.uniform1i(e.location,e.value)}setUniform1iv(e){this.gl.uniform1iv(e.location,e.value)}setUniform1f(e){this.gl.uniform1f(e.location,e.value)}setUniform1fv(e){this.gl.uniform1fv(e.location,e.value)}setUniform2i(e){e._internalFormat==="Vec2"?this.gl.uniform2i(e.location,e.value.x,e.value.y):this.gl.uniform2i(e.location,e.value[0],e.value[1])}setUniform2iv(e){e._internalFormat==="Vec2"?this.gl.uniform2iv(e.location,[e.value.x,e.value.y]):this.gl.uniform2iv(e.location,e.value)}setUniform2f(e){e._internalFormat==="Vec2"?this.gl.uniform2f(e.location,e.value.x,e.value.y):this.gl.uniform2f(e.location,e.value[0],e.value[1])}setUniform2fv(e){e._internalFormat==="Vec2"?this.gl.uniform2fv(e.location,[e.value.x,e.value.y]):this.gl.uniform2fv(e.location,e.value)}setUniform3i(e){e._internalFormat==="Vec3"?this.gl.uniform3i(e.location,e.value.x,e.value.y,e.value.z):this.gl.uniform3i(e.location,e.value[0],e.value[1],e.value[2])}setUniform3iv(e){e._internalFormat==="Vec3"?this.gl.uniform3iv(e.location,[e.value.x,e.value.y,e.value.z]):this.gl.uniform3iv(e.location,e.value)}setUniform3f(e){e._internalFormat==="Vec3"?this.gl.uniform3f(e.location,e.value.x,e.value.y,e.value.z):this.gl.uniform3f(e.location,e.value[0],e.value[1],e.value[2])}setUniform3fv(e){e._internalFormat==="Vec3"?this.gl.uniform3fv(e.location,[e.value.x,e.value.y,e.value.z]):this.gl.uniform3fv(e.location,e.value)}setUniform4i(e){e._internalFormat==="Quat"?this.gl.uniform4i(e.location,e.value.elements[0],e.value.elements[1],e.value.elements[2],e.value[3]):this.gl.uniform4i(e.location,e.value[0],e.value[1],e.value[2],e.value[3])}setUniform4iv(e){e._internalFormat==="Quat"?this.gl.uniform4iv(e.location,[e.value.elements[0],e.value.elements[1],e.value.elements[2],e.value[3]]):this.gl.uniform4iv(e.location,e.value)}setUniform4f(e){e._internalFormat==="Quat"?this.gl.uniform4f(e.location,e.value.elements[0],e.value.elements[1],e.value.elements[2],e.value[3]):this.gl.uniform4f(e.location,e.value[0],e.value[1],e.value[2],e.value[3])}setUniform4fv(e){e._internalFormat==="Quat"?this.gl.uniform4fv(e.location,[e.value.elements[0],e.value.elements[1],e.value.elements[2],e.value[3]]):this.gl.uniform4fv(e.location,e.value)}setUniformMatrix2fv(e){this.gl.uniformMatrix2fv(e.location,!1,e.value)}setUniformMatrix3fv(e){this.gl.uniformMatrix3fv(e.location,!1,e.value)}setUniformMatrix4fv(e){e._internalFormat==="Mat4"?this.gl.uniformMatrix4fv(e.location,!1,e.value.elements):this.gl.uniformMatrix4fv(e.location,!1,e.value)}}const Jn=`
precision mediump float;
`;var xs=Jn.replace(/\n/g,"");const ea=`
attribute vec3 aVertexPosition;
attribute vec2 aTextureCoord;
`;var on=ea.replace(/\n/g,"");const ta=`
varying vec3 vVertexPosition;
varying vec2 vTextureCoord;
`;var ys=ta.replace(/\n/g,"");const ia=xs+on+ys+`
uniform mat4 uMVMatrix;
uniform mat4 uPMatrix;

void main() {
    vTextureCoord = aTextureCoord;
    vVertexPosition = aVertexPosition;
    
    gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);
}
`;var sa=ia.replace(/\n/g,"");const ra=xs+ys+`
void main() {
    gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);
}
`;var na=ra.replace(/\n/g,"");const aa=xs+on+ys+`
void main() {
    vTextureCoord = aTextureCoord;
    vVertexPosition = aVertexPosition;
    
    gl_Position = vec4(aVertexPosition, 1.0);
}
`;var oa=aa.replace(/\n/g,"");const ha=xs+ys+`
uniform sampler2D uRenderTexture;

void main() {
    gl_FragColor = texture2D(uRenderTexture, vTextureCoord);
}
`;var la=ha.replace(/\n/g,"");let vr=0;class wr{constructor(e,{parent:t,vertexShader:i,fragmentShader:s}={}){if(this.type="Program",!e||e.type!=="Renderer")Ue(this.type+": Renderer not passed as first argument",e);else if(!e.gl){Ue(this.type+": Renderer WebGL context is undefined",e);return}this.renderer=e,this.gl=this.renderer.gl,this.parent=t,this.defaultVsCode=this.parent.type==="Plane"?sa:oa,this.defaultFsCode=this.parent.type==="Plane"?na:la,i?this.vsCode=i:(!this.renderer.production&&this.parent.type==="Plane"&&R(this.parent.type+": No vertex shader provided, will use a default one"),this.vsCode=this.defaultVsCode),s?this.fsCode=s:(this.renderer.production||R(this.parent.type+": No fragment shader provided, will use a default one"),this.fsCode=this.defaultFsCode),this.compiled=!0,this.setupProgram()}createShader(e,t){const i=this.gl.createShader(t);if(this.gl.shaderSource(i,e),this.gl.compileShader(i),!this.renderer.production&&!this.gl.getShaderParameter(i,this.gl.COMPILE_STATUS)){const s=t===this.gl.VERTEX_SHADER?"vertex shader":"fragment shader";let n=this.gl.getShaderSource(i).split(`
`);for(let a=0;a<n.length;a++)n[a]=a+1+": "+n[a];return n=n.join(`
`),R(this.type+": Errors occurred while compiling the",s,`:
`,this.gl.getShaderInfoLog(i)),Ue(n),R(this.type+": Will use a default",s),this.createShader(t===this.gl.VERTEX_SHADER?this.defaultVsCode:this.defaultFsCode,t)}return i}useNewShaders(){this.vertexShader=this.createShader(this.vsCode,this.gl.VERTEX_SHADER),this.fragmentShader=this.createShader(this.fsCode,this.gl.FRAGMENT_SHADER),(!this.vertexShader||!this.fragmentShader)&&(this.renderer.production||R(this.type+": Unable to find or compile the vertex or fragment shader"))}setupProgram(){let e=this.renderer.cache.getProgramFromShaders(this.vsCode,this.fsCode);e?(this.vertexShader=e.vertexShader,this.fragmentShader=e.fragmentShader,this.activeUniforms=e.activeUniforms,this.activeAttributes=e.activeAttributes,this.createProgram()):(this.useNewShaders(),this.compiled&&(this.createProgram(),this.renderer.cache.addProgram(this)))}createProgram(){if(vr++,this.id=vr,this.program=this.gl.createProgram(),this.gl.attachShader(this.program,this.vertexShader),this.gl.attachShader(this.program,this.fragmentShader),this.gl.linkProgram(this.program),!this.renderer.production&&!this.gl.getProgramParameter(this.program,this.gl.LINK_STATUS)){R(this.type+": Unable to initialize the shader program: "+this.gl.getProgramInfoLog(this.program)),R(this.type+": Will use default vertex and fragment shaders"),this.vertexShader=this.createShader(this.defaultVsCode,this.gl.VERTEX_SHADER),this.fragmentShader=this.createShader(this.defaultFsCode,this.gl.FRAGMENT_SHADER),this.createProgram();return}if(this.gl.deleteShader(this.vertexShader),this.gl.deleteShader(this.fragmentShader),!this.activeUniforms||!this.activeAttributes){this.activeUniforms={textures:[],textureMatrices:[]};const e=this.gl.getProgramParameter(this.program,this.gl.ACTIVE_UNIFORMS);for(let i=0;i<e;i++){const s=this.gl.getActiveUniform(this.program,i);s.type===this.gl.SAMPLER_2D&&this.activeUniforms.textures.push(s.name),s.type===this.gl.FLOAT_MAT4&&s.name!=="uMVMatrix"&&s.name!=="uPMatrix"&&this.activeUniforms.textureMatrices.push(s.name)}this.activeAttributes=[];const t=this.gl.getProgramParameter(this.program,this.gl.ACTIVE_ATTRIBUTES);for(let i=0;i<t;i++){const s=this.gl.getActiveAttrib(this.program,i);this.activeAttributes.push(s.name)}}}createUniforms(e){this.uniformsManager=new Kn(this.renderer,this.program,e),this.setUniforms()}setUniforms(){this.renderer.useProgram(this),this.uniformsManager.setUniforms()}updateUniforms(){this.renderer.useProgram(this),this.uniformsManager.updateUniforms()}}class da{constructor(e,{program:t=null,width:i=1,height:s=1}={}){if(this.type="Geometry",!e||e.type!=="Renderer")Ue(this.type+": Renderer not passed as first argument",e);else if(!e.gl){Ue(this.type+": Renderer WebGL context is undefined",e);return}this.renderer=e,this.gl=this.renderer.gl,this.definition={id:i*s+i,width:i,height:s},this.setDefaultAttributes(),this.setVerticesUVs()}restoreContext(e){this.program=null,this.setDefaultAttributes(),this.setVerticesUVs(),this.setProgram(e)}setDefaultAttributes(){this.attributes={vertexPosition:{name:"aVertexPosition",size:3,isActive:!1},textureCoord:{name:"aTextureCoord",size:3,isActive:!1}}}setVerticesUVs(){const e=this.renderer.cache.getGeometryFromID(this.definition.id);e?(this.attributes.vertexPosition.array=e.vertices,this.attributes.textureCoord.array=e.uvs):(this.computeVerticesUVs(),this.renderer.cache.addGeometry(this.definition.id,this.attributes.vertexPosition.array,this.attributes.textureCoord.array))}setProgram(e){this.program=e,this.initAttributes(),this.renderer._isWebGL2?(this._vao=this.gl.createVertexArray(),this.gl.bindVertexArray(this._vao)):this.renderer.extensions.OES_vertex_array_object&&(this._vao=this.renderer.extensions.OES_vertex_array_object.createVertexArrayOES(),this.renderer.extensions.OES_vertex_array_object.bindVertexArrayOES(this._vao)),this.initializeBuffers()}initAttributes(){for(const e in this.attributes){if(this.attributes[e].isActive=this.program.activeAttributes.includes(this.attributes[e].name),!this.attributes[e].isActive)return;this.attributes[e].location=this.gl.getAttribLocation(this.program.program,this.attributes[e].name),this.attributes[e].buffer=this.gl.createBuffer(),this.attributes[e].numberOfItems=this.definition.width*this.definition.height*this.attributes[e].size*2}}computeVerticesUVs(){this.attributes.vertexPosition.array=[],this.attributes.textureCoord.array=[];const e=this.attributes.vertexPosition.array,t=this.attributes.textureCoord.array;for(let i=0;i<this.definition.height;i++){const s=i/this.definition.height;for(let r=0;r<this.definition.width;r++){const n=r/this.definition.width;t.push(n),t.push(s),t.push(0),e.push((n-.5)*2),e.push((s-.5)*2),e.push(0),t.push(n+1/this.definition.width),t.push(s),t.push(0),e.push((n+1/this.definition.width-.5)*2),e.push((s-.5)*2),e.push(0),t.push(n),t.push(s+1/this.definition.height),t.push(0),e.push((n-.5)*2),e.push((s+1/this.definition.height-.5)*2),e.push(0),t.push(n),t.push(s+1/this.definition.height),t.push(0),e.push((n-.5)*2),e.push((s+1/this.definition.height-.5)*2),e.push(0),t.push(n+1/this.definition.width),t.push(s),t.push(0),e.push((n+1/this.definition.width-.5)*2),e.push((s-.5)*2),e.push(0),t.push(n+1/this.definition.width),t.push(s+1/this.definition.height),t.push(0),e.push((n+1/this.definition.width-.5)*2),e.push((s+1/this.definition.height-.5)*2),e.push(0)}}}initializeBuffers(){if(this.attributes){for(const e in this.attributes){if(!this.attributes[e].isActive)return;this.gl.enableVertexAttribArray(this.attributes[e].location),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.attributes[e].buffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(this.attributes[e].array),this.gl.STATIC_DRAW),this.gl.vertexAttribPointer(this.attributes[e].location,this.attributes[e].size,this.gl.FLOAT,!1,0,0)}this.renderer.state.currentGeometryID=this.definition.id}}bindBuffers(){if(this._vao)this.renderer._isWebGL2?this.gl.bindVertexArray(this._vao):this.renderer.extensions.OES_vertex_array_object.bindVertexArrayOES(this._vao);else for(const e in this.attributes){if(!this.attributes[e].isActive)return;this.gl.enableVertexAttribArray(this.attributes[e].location),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.attributes[e].buffer),this.gl.vertexAttribPointer(this.attributes[e].location,this.attributes[e].size,this.gl.FLOAT,!1,0,0)}this.renderer.state.currentGeometryID=this.definition.id}draw(){this.gl.drawArrays(this.gl.TRIANGLES,0,this.attributes.vertexPosition.numberOfItems)}dispose(){this._vao&&(this.renderer._isWebGL2?this.gl.deleteVertexArray(this._vao):this.renderer.extensions.OES_vertex_array_object.deleteVertexArrayOES(this._vao));for(const e in this.attributes){if(!this.attributes[e].isActive)return;this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.attributes[e].buffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,1,this.gl.STATIC_DRAW),this.gl.deleteBuffer(this.attributes[e].buffer)}this.attributes=null,this.renderer.state.currentGeometryID=null}}class bt{constructor(e=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])){this.type="Mat4",this.elements=e}setFromArray(e){for(let t=0;t<this.elements.length;t++)this.elements[t]=e[t];return this}copy(e){const t=e.elements;return this.elements[0]=t[0],this.elements[1]=t[1],this.elements[2]=t[2],this.elements[3]=t[3],this.elements[4]=t[4],this.elements[5]=t[5],this.elements[6]=t[6],this.elements[7]=t[7],this.elements[8]=t[8],this.elements[9]=t[9],this.elements[10]=t[10],this.elements[11]=t[11],this.elements[12]=t[12],this.elements[13]=t[13],this.elements[14]=t[14],this.elements[15]=t[15],this}clone(){return new bt().copy(this)}multiply(e){const t=this.elements,i=e.elements;let s=new bt;return s.elements[0]=i[0]*t[0]+i[1]*t[4]+i[2]*t[8]+i[3]*t[12],s.elements[1]=i[0]*t[1]+i[1]*t[5]+i[2]*t[9]+i[3]*t[13],s.elements[2]=i[0]*t[2]+i[1]*t[6]+i[2]*t[10]+i[3]*t[14],s.elements[3]=i[0]*t[3]+i[1]*t[7]+i[2]*t[11]+i[3]*t[15],s.elements[4]=i[4]*t[0]+i[5]*t[4]+i[6]*t[8]+i[7]*t[12],s.elements[5]=i[4]*t[1]+i[5]*t[5]+i[6]*t[9]+i[7]*t[13],s.elements[6]=i[4]*t[2]+i[5]*t[6]+i[6]*t[10]+i[7]*t[14],s.elements[7]=i[4]*t[3]+i[5]*t[7]+i[6]*t[11]+i[7]*t[15],s.elements[8]=i[8]*t[0]+i[9]*t[4]+i[10]*t[8]+i[11]*t[12],s.elements[9]=i[8]*t[1]+i[9]*t[5]+i[10]*t[9]+i[11]*t[13],s.elements[10]=i[8]*t[2]+i[9]*t[6]+i[10]*t[10]+i[11]*t[14],s.elements[11]=i[8]*t[3]+i[9]*t[7]+i[10]*t[11]+i[11]*t[15],s.elements[12]=i[12]*t[0]+i[13]*t[4]+i[14]*t[8]+i[15]*t[12],s.elements[13]=i[12]*t[1]+i[13]*t[5]+i[14]*t[9]+i[15]*t[13],s.elements[14]=i[12]*t[2]+i[13]*t[6]+i[14]*t[10]+i[15]*t[14],s.elements[15]=i[12]*t[3]+i[13]*t[7]+i[14]*t[11]+i[15]*t[15],s}getInverse(){const e=this.elements,t=new bt,i=t.elements;let s=e[0],r=e[1],n=e[2],a=e[3],h=e[4],u=e[5],p=e[6],_=e[7],f=e[8],d=e[9],g=e[10],C=e[11],S=e[12],z=e[13],E=e[14],B=e[15],v=s*u-r*h,j=s*p-n*h,A=s*_-a*h,b=r*p-n*u,q=r*_-a*u,Q=n*_-a*p,y=f*z-d*S,H=f*E-g*S,w=f*B-C*S,_e=d*E-g*z,Y=d*B-C*z,K=g*B-C*E,k=v*K-j*Y+A*_e+b*w-q*H+Q*y;return k?(k=1/k,i[0]=(u*K-p*Y+_*_e)*k,i[1]=(n*Y-r*K-a*_e)*k,i[2]=(z*Q-E*q+B*b)*k,i[3]=(g*q-d*Q-C*b)*k,i[4]=(p*w-h*K-_*H)*k,i[5]=(s*K-n*w+a*H)*k,i[6]=(E*A-S*Q-B*j)*k,i[7]=(f*Q-g*A+C*j)*k,i[8]=(h*Y-u*w+_*y)*k,i[9]=(r*w-s*Y-a*y)*k,i[10]=(S*q-z*A+B*v)*k,i[11]=(d*A-f*q-C*v)*k,i[12]=(u*H-h*_e-p*y)*k,i[13]=(s*_e-r*H+n*y)*k,i[14]=(z*j-S*b-E*v)*k,i[15]=(f*b-d*j+g*v)*k,t):null}scale(e){let t=this.elements;return t[0]*=e.x,t[1]*=e.x,t[2]*=e.x,t[3]*=e.x,t[4]*=e.y,t[5]*=e.y,t[6]*=e.y,t[7]*=e.y,t[8]*=e.z,t[9]*=e.z,t[10]*=e.z,t[11]*=e.z,this}compose(e,t,i){let s=this.elements;const r=t.elements[0],n=t.elements[1],a=t.elements[2],h=t.elements[3],u=r+r,p=n+n,_=a+a,f=r*u,d=r*p,g=r*_,C=n*p,S=n*_,z=a*_,E=h*u,B=h*p,v=h*_,j=i.x,A=i.y,b=i.z;return s[0]=(1-(C+z))*j,s[1]=(d+v)*j,s[2]=(g-B)*j,s[3]=0,s[4]=(d-v)*A,s[5]=(1-(f+z))*A,s[6]=(S+E)*A,s[7]=0,s[8]=(g+B)*b,s[9]=(S-E)*b,s[10]=(1-(f+C))*b,s[11]=0,s[12]=e.x,s[13]=e.y,s[14]=e.z,s[15]=1,this}composeFromOrigin(e,t,i,s){let r=this.elements;const n=t.elements[0],a=t.elements[1],h=t.elements[2],u=t.elements[3],p=n+n,_=a+a,f=h+h,d=n*p,g=n*_,C=n*f,S=a*_,z=a*f,E=h*f,B=u*p,v=u*_,j=u*f,A=i.x,b=i.y,q=i.z,Q=s.x,y=s.y,H=s.z,w=(1-(S+E))*A,_e=(g+j)*A,Y=(C-v)*A,K=(g-j)*b,k=(1-(d+E))*b,X=(z+B)*b,J=(C+v)*q,ee=(z-B)*q,l=(1-(d+S))*q;return r[0]=w,r[1]=_e,r[2]=Y,r[3]=0,r[4]=K,r[5]=k,r[6]=X,r[7]=0,r[8]=J,r[9]=ee,r[10]=l,r[11]=0,r[12]=e.x+Q-(w*Q+K*y+J*H),r[13]=e.y+y-(_e*Q+k*y+ee*H),r[14]=e.z+H-(Y*Q+X*y+l*H),r[15]=1,this}}class Ct{constructor(e=0,t=e){this.type="Vec2",this._x=e,this._y=t}get x(){return this._x}get y(){return this._y}set x(e){const t=e!==this._x;this._x=e,t&&this._onChangeCallback&&this._onChangeCallback()}set y(e){const t=e!==this._y;this._y=e,t&&this._onChangeCallback&&this._onChangeCallback()}onChange(e){return e&&(this._onChangeCallback=e),this}set(e,t){return this._x=e,this._y=t,this}add(e){return this._x+=e.x,this._y+=e.y,this}addScalar(e){return this._x+=e,this._y+=e,this}sub(e){return this._x-=e.x,this._y-=e.y,this}subScalar(e){return this._x-=e,this._y-=e,this}multiply(e){return this._x*=e.x,this._y*=e.y,this}multiplyScalar(e){return this._x*=e,this._y*=e,this}copy(e){return this._x=e.x,this._y=e.y,this}clone(){return new Ct(this._x,this._y)}sanitizeNaNValuesWith(e){return this._x=isNaN(this._x)?e.x:parseFloat(this._x),this._y=isNaN(this._y)?e.y:parseFloat(this._y),this}max(e){return this._x=Math.max(this._x,e.x),this._y=Math.max(this._y,e.y),this}min(e){return this._x=Math.min(this._x,e.x),this._y=Math.min(this._y,e.y),this}equals(e){return this._x===e.x&&this._y===e.y}normalize(){let e=this._x*this._x+this._y*this._y;return e>0&&(e=1/Math.sqrt(e)),this._x*=e,this._y*=e,this}dot(e){return this._x*e.x+this._y*e.y}}class re{constructor(e=0,t=e,i=e){this.type="Vec3",this._x=e,this._y=t,this._z=i}get x(){return this._x}get y(){return this._y}get z(){return this._z}set x(e){const t=e!==this._x;this._x=e,t&&this._onChangeCallback&&this._onChangeCallback()}set y(e){const t=e!==this._y;this._y=e,t&&this._onChangeCallback&&this._onChangeCallback()}set z(e){const t=e!==this._z;this._z=e,t&&this._onChangeCallback&&this._onChangeCallback()}onChange(e){return e&&(this._onChangeCallback=e),this}set(e,t,i){return this._x=e,this._y=t,this._z=i,this}add(e){return this._x+=e.x,this._y+=e.y,this._z+=e.z,this}addScalar(e){return this._x+=e,this._y+=e,this._z+=e,this}sub(e){return this._x-=e.x,this._y-=e.y,this._z-=e.z,this}subScalar(e){return this._x-=e,this._y-=e,this._z-=e,this}multiply(e){return this._x*=e.x,this._y*=e.y,this._z*=e.z,this}multiplyScalar(e){return this._x*=e,this._y*=e,this._z*=e,this}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this}clone(){return new re(this._x,this._y,this._z)}sanitizeNaNValuesWith(e){return this._x=isNaN(this._x)?e.x:parseFloat(this._x),this._y=isNaN(this._y)?e.y:parseFloat(this._y),this._z=isNaN(this._z)?e.z:parseFloat(this._z),this}max(e){return this._x=Math.max(this._x,e.x),this._y=Math.max(this._y,e.y),this._z=Math.max(this._z,e.z),this}min(e){return this._x=Math.min(this._x,e.x),this._y=Math.min(this._y,e.y),this._z=Math.min(this._z,e.z),this}equals(e){return this._x===e.x&&this._y===e.y&&this._z===e.z}normalize(){let e=this._x*this._x+this._y*this._y+this._z*this._z;return e>0&&(e=1/Math.sqrt(e)),this._x*=e,this._y*=e,this._z*=e,this}dot(e){return this._x*e.x+this._y*e.y+this._z*e.z}applyMat4(e){const t=this._x,i=this._y,s=this._z,r=e.elements;let n=r[3]*t+r[7]*i+r[11]*s+r[15];return n=n||1,this._x=(r[0]*t+r[4]*i+r[8]*s+r[12])/n,this._y=(r[1]*t+r[5]*i+r[9]*s+r[13])/n,this._z=(r[2]*t+r[6]*i+r[10]*s+r[14])/n,this}applyQuat(e){const t=this._x,i=this._y,s=this._z,r=e.elements[0],n=e.elements[1],a=e.elements[2],h=e.elements[3],u=h*t+n*s-a*i,p=h*i+a*t-r*s,_=h*s+r*i-n*t,f=-r*t-n*i-a*s;return this._x=u*h+f*-r+p*-a-_*-n,this._y=p*h+f*-n+_*-r-u*-a,this._z=_*h+f*-a+u*-n-p*-r,this}project(e){return this.applyMat4(e.viewMatrix).applyMat4(e.projectionMatrix),this}unproject(e){return this.applyMat4(e.projectionMatrix.getInverse()).applyMat4(e.worldMatrix),this}}const ks=new Ct,ua=new re,ca=new bt;class Ci{constructor(e,{isFBOTexture:t=!1,fromTexture:i=!1,loader:s,sampler:r,floatingPoint:n="none",premultiplyAlpha:a=!1,anisotropy:h=1,generateMipmap:u=null,wrapS:p,wrapT:_,minFilter:f,magFilter:d}={}){if(this.type="Texture",e=e&&e.renderer||e,!e||e.type!=="Renderer")Ue(this.type+": Renderer not passed as first argument",e);else if(!e.gl){e.production||Ue(this.type+": Unable to create a "+this.type+" because the Renderer WebGL context is not defined");return}if(this.renderer=e,this.gl=this.renderer.gl,this.uuid=an(),this._globalParameters={unpackAlignment:4,flipY:!t,premultiplyAlpha:!1,shouldPremultiplyAlpha:a,floatingPoint:n,type:this.gl.UNSIGNED_BYTE,internalFormat:this.gl.RGBA,format:this.gl.RGBA},this.parameters={anisotropy:h,generateMipmap:u,wrapS:p||this.gl.CLAMP_TO_EDGE,wrapT:_||this.gl.CLAMP_TO_EDGE,minFilter:f||this.gl.LINEAR,magFilter:d||this.gl.LINEAR,_shouldUpdate:!0},this._initState(),this.sourceType=t?"fbo":"empty",this._useCache=!0,this._samplerName=r,this._sampler={isActive:!1,isTextureBound:!1,texture:this.gl.createTexture()},this._textureMatrix={matrix:new bt,isActive:!1},this._size={width:1,height:1},this.scale=new Ct(1),this.scale.onChange(()=>this.resize()),this.offset=new Ct,this.offset.onChange(()=>this.resize()),this._loader=s,this._sourceLoaded=!1,this._uploaded=!1,this._willUpdate=!1,this.shouldUpdate=!1,this._forceUpdate=!1,this.userData={},this._canDraw=!1,i){this._copyOnInit=!0,this._copiedFrom=i;return}this._copyOnInit=!1,this._initTexture()}_initState(){this._state={anisotropy:1,generateMipmap:!1,wrapS:null,wrapT:null,minFilter:null,magFilter:this.gl.LINEAR}}_initTexture(){this.gl.bindTexture(this.gl.TEXTURE_2D,this._sampler.texture),this.sourceType==="empty"&&(this._globalParameters.flipY=!1,this._updateGlobalTexParameters(),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,1,1,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,new Uint8Array([0,0,0,255])),this._canDraw=!0)}_restoreFromTexture(){this._copyOnInit||this._initTexture(),this._parent&&(this._setTextureUniforms(),this._setSize()),this.copy(this._copiedFrom),this._canDraw=!0}_restoreContext(){if(this._canDraw=!1,this._sampler.texture=this.gl.createTexture(),this._sampler.isActive=!1,this._sampler.isTextureBound=!1,this._textureMatrix.isActive=!1,this._initState(),this._state.generateMipmap=!1,this.parameters._shouldUpdate=!0,!this._copiedFrom)this._initTexture(),this._parent&&this._setParent(),this.source&&(this.setSource(this.source),this.sourceType==="image"?this.renderer.cache.addTexture(this):this.needUpdate()),this._canDraw=!0;else{const e=this.renderer.nextRender.add(()=>{this._copiedFrom._canDraw&&(this._restoreFromTexture(),e.keep=!1)},!0)}}addParent(e){if(!e||e.type!=="Plane"&&e.type!=="PingPongPlane"&&e.type!=="ShaderPass"&&e.type!=="RenderTarget"){this.renderer.production||R(this.type+": cannot add texture as a child of ",e," because it is not a valid parent");return}this._parent=e,this.index=this._parent.textures.length,this._parent.textures.push(this),this._setParent()}_setParent(){if(this._sampler.name=this._samplerName||"uSampler"+this.index,this._textureMatrix.name=this._samplerName?this._samplerName+"Matrix":"uTextureMatrix"+this.index,this._parent._program){if(!this._parent._program.compiled){this.renderer.production||R(this.type+": Unable to create the texture because the program is not valid");return}if(this._setTextureUniforms(),this._copyOnInit){const e=this.renderer.nextRender.add(()=>{this._copiedFrom._canDraw&&this._copiedFrom._uploaded&&(this.copy(this._copiedFrom),e.keep=!1)},!0);return}this.source?this._parent.loader&&this._parent.loader._addSourceToParent(this.source,this.sourceType):this._size={width:this._parent._boundingRect.document.width,height:this._parent._boundingRect.document.height},this._setSize()}else this._parent.type==="RenderTarget"&&(this._size={width:this._parent._size&&this._parent._size.width||this.renderer._boundingRect.width,height:this._parent._size&&this._parent._size.height||this.renderer._boundingRect.height},this._upload(),this._updateTexParameters(),this._canDraw=!0)}hasParent(){return!!this._parent}_setTextureUniforms(){const e=this._parent._program.activeUniforms;for(let t=0;t<e.textures.length;t++)e.textures[t]===this._sampler.name&&(this._sampler.isActive=!0,this.renderer.useProgram(this._parent._program),this._sampler.location=this.gl.getUniformLocation(this._parent._program.program,this._sampler.name),e.textureMatrices.find(s=>s===this._textureMatrix.name)&&(this._textureMatrix.isActive=!0,this._textureMatrix.location=this.gl.getUniformLocation(this._parent._program.program,this._textureMatrix.name)),this.gl.uniform1i(this._sampler.location,this.index))}copy(e){if(!e||e.type!=="Texture"){this.renderer.production||R(this.type+": Unable to set the texture from texture:",e);return}this._globalParameters=Object.assign({},e._globalParameters),this._state=Object.assign({},e._state),this.parameters.generateMipmap=e.parameters.generateMipmap,this._state.generateMipmap=null,this._size=e._size,!this._sourceLoaded&&e._sourceLoaded&&this._onSourceLoadedCallback&&this._onSourceLoadedCallback(),this._sourceLoaded=e._sourceLoaded,!this._uploaded&&e._uploaded&&this._onSourceUploadedCallback&&this._onSourceUploadedCallback(),this._uploaded=e._uploaded,this.sourceType=e.sourceType,this.source=e.source,this._videoFrameCallbackID=e._videoFrameCallbackID,this._sampler.texture=e._sampler.texture,this._copiedFrom=e,this._parent&&this._parent._program&&(!this._canDraw||!this._textureMatrix.matrix)&&(this._setSize(),this._canDraw=!0),this._updateTexParameters(),this.renderer.needRender()}setSource(e){this._sourceLoaded||this.renderer.nextRender.add(()=>this._onSourceLoadedCallback&&this._onSourceLoadedCallback());const t=e.tagName.toUpperCase()==="IMG"?"image":e.tagName.toLowerCase();if((t==="video"||t==="canvas")&&(this._useCache=!1),this._useCache){const i=this.renderer.cache.getTextureFromSource(e);if(i&&i.uuid!==this.uuid){this._uploaded||(this.renderer.nextRender.add(()=>this._onSourceUploadedCallback&&this._onSourceUploadedCallback()),this._uploaded=!0),this.copy(i),this.resize();return}}if(this.sourceType==="empty"||this.sourceType!==t)if(t==="video")this._willUpdate=!1,this.shouldUpdate=!0;else if(t==="canvas")this._willUpdate=!0,this.shouldUpdate=!0;else if(t==="image")this._willUpdate=!1,this.shouldUpdate=!1;else{this.renderer.production||R(this.type+": this HTML tag could not be converted into a texture:",e.tagName);return}this.source=e,this.sourceType=t,this._size={width:this.source.naturalWidth||this.source.width||this.source.videoWidth,height:this.source.naturalHeight||this.source.height||this.source.videoHeight},this._sourceLoaded=!0,this.gl.bindTexture(this.gl.TEXTURE_2D,this._sampler.texture),this.resize(),this._globalParameters.flipY=!0,this._globalParameters.premultiplyAlpha=this._globalParameters.shouldPremultiplyAlpha,this.sourceType==="image"&&(this.parameters.generateMipmap=this.parameters.generateMipmap||this.parameters.generateMipmap===null,this.parameters._shouldUpdate=this.parameters.generateMipmap,this._state.generateMipmap=!1,this._upload()),this.renderer.needRender()}_updateGlobalTexParameters(){this.renderer.state.unpackAlignment!==this._globalParameters.unpackAlignment&&(this.gl.pixelStorei(this.gl.UNPACK_ALIGNMENT,this._globalParameters.unpackAlignment),this.renderer.state.unpackAlignment=this._globalParameters.unpackAlignment),this.renderer.state.flipY!==this._globalParameters.flipY&&(this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,this._globalParameters.flipY),this.renderer.state.flipY=this._globalParameters.flipY),this.renderer.state.premultiplyAlpha!==this._globalParameters.premultiplyAlpha&&(this.gl.pixelStorei(this.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this._globalParameters.premultiplyAlpha),this.renderer.state.premultiplyAlpha=this._globalParameters.premultiplyAlpha),this._globalParameters.floatingPoint==="half-float"?this.renderer._isWebGL2&&this.renderer.extensions.EXT_color_buffer_float?(this._globalParameters.internalFormat=this.gl.RGBA16F,this._globalParameters.type=this.gl.HALF_FLOAT):this.renderer.extensions.OES_texture_half_float?this._globalParameters.type=this.renderer.extensions.OES_texture_half_float.HALF_FLOAT_OES:this.renderer.production||R(this.type+": could not use half-float textures because the extension is not available"):this._globalParameters.floatingPoint==="float"&&(this.renderer._isWebGL2&&this.renderer.extensions.EXT_color_buffer_float?(this._globalParameters.internalFormat=this.gl.RGBA16F,this._globalParameters.type=this.gl.FLOAT):this.renderer.extensions.OES_texture_float?this._globalParameters.type=this.renderer.extensions.OES_texture_half_float.FLOAT:this.renderer.production||R(this.type+": could not use float textures because the extension is not available"))}_updateTexParameters(){this.index&&this.renderer.state.activeTexture!==this.index&&this._bindTexture(),this.parameters.wrapS!==this._state.wrapS&&(!this.renderer._isWebGL2&&(!mt(this._size.width)||!mt(this._size.height))&&(this.parameters.wrapS=this.gl.CLAMP_TO_EDGE),this.parameters.wrapS!==this.gl.REPEAT&&this.parameters.wrapS!==this.gl.CLAMP_TO_EDGE&&this.parameters.wrapS!==this.gl.MIRRORED_REPEAT&&(this.renderer.production||R(this.type+": Wrong wrapS value",this.parameters.wrapS,"for this texture:",this,`
gl.CLAMP_TO_EDGE wrapping will be used instead`),this.parameters.wrapS=this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.parameters.wrapS),this._state.wrapS=this.parameters.wrapS),this.parameters.wrapT!==this._state.wrapT&&(!this.renderer._isWebGL2&&(!mt(this._size.width)||!mt(this._size.height))&&(this.parameters.wrapT=this.gl.CLAMP_TO_EDGE),this.parameters.wrapT!==this.gl.REPEAT&&this.parameters.wrapT!==this.gl.CLAMP_TO_EDGE&&this.parameters.wrapT!==this.gl.MIRRORED_REPEAT&&(this.renderer.production||R(this.type+": Wrong wrapT value",this.parameters.wrapT,"for this texture:",this,`
gl.CLAMP_TO_EDGE wrapping will be used instead`),this.parameters.wrapT=this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.parameters.wrapT),this._state.wrapT=this.parameters.wrapT),this.parameters.generateMipmap&&!this._state.generateMipmap&&this.source&&(!this.renderer._isWebGL2&&(!mt(this._size.width)||!mt(this._size.height))?this.parameters.generateMipmap=!1:this.gl.generateMipmap(this.gl.TEXTURE_2D),this._state.generateMipmap=this.parameters.generateMipmap),this.parameters.minFilter!==this._state.minFilter&&(!this.renderer._isWebGL2&&(!mt(this._size.width)||!mt(this._size.height))&&(this.parameters.minFilter=this.gl.LINEAR),!this.parameters.generateMipmap&&this.parameters.generateMipmap!==null&&(this.parameters.minFilter=this.gl.LINEAR),this.parameters.minFilter!==this.gl.LINEAR&&this.parameters.minFilter!==this.gl.NEAREST&&this.parameters.minFilter!==this.gl.NEAREST_MIPMAP_NEAREST&&this.parameters.minFilter!==this.gl.LINEAR_MIPMAP_NEAREST&&this.parameters.minFilter!==this.gl.NEAREST_MIPMAP_LINEAR&&this.parameters.minFilter!==this.gl.LINEAR_MIPMAP_LINEAR&&(this.renderer.production||R(this.type+": Wrong minFilter value",this.parameters.minFilter,"for this texture:",this,`
gl.LINEAR filtering will be used instead`),this.parameters.minFilter=this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.parameters.minFilter),this._state.minFilter=this.parameters.minFilter),this.parameters.magFilter!==this._state.magFilter&&(!this.renderer._isWebGL2&&(!mt(this._size.width)||!mt(this._size.height))&&(this.parameters.magFilter=this.gl.LINEAR),this.parameters.magFilter!==this.gl.LINEAR&&this.parameters.magFilter!==this.gl.NEAREST&&(this.renderer.production||R(this.type+": Wrong magFilter value",this.parameters.magFilter,"for this texture:",this,`
gl.LINEAR filtering will be used instead`),this.parameters.magFilter=this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.parameters.magFilter),this._state.magFilter=this.parameters.magFilter);const e=this.renderer.extensions.EXT_texture_filter_anisotropic;if(e&&this.parameters.anisotropy!==this._state.anisotropy){const t=this.gl.getParameter(e.MAX_TEXTURE_MAX_ANISOTROPY_EXT);this.parameters.anisotropy=Math.max(1,Math.min(this.parameters.anisotropy,t)),this.gl.texParameterf(this.gl.TEXTURE_2D,e.TEXTURE_MAX_ANISOTROPY_EXT,this.parameters.anisotropy),this._state.anisotropy=this.parameters.anisotropy}}setWrapS(e){this.parameters.wrapS!==e&&(this.parameters.wrapS=e,this.parameters._shouldUpdate=!0)}setWrapT(e){this.parameters.wrapT!==e&&(this.parameters.wrapT=e,this.parameters._shouldUpdate=!0)}setMinFilter(e){this.parameters.minFilter!==e&&(this.parameters.minFilter=e,this.parameters._shouldUpdate=!0)}setMagFilter(e){this.parameters.magFilter!==e&&(this.parameters.magFilter=e,this.parameters._shouldUpdate=!0)}setAnisotropy(e){e=isNaN(e)?this.parameters.anisotropy:e,this.parameters.anisotropy!==e&&(this.parameters.anisotropy=e,this.parameters._shouldUpdate=!0)}needUpdate(){this._forceUpdate=!0}_videoFrameCallback(){this._willUpdate=!0,this.source.requestVideoFrameCallback(()=>this._videoFrameCallback())}_upload(){this._updateGlobalTexParameters(),this.source?this.gl.texImage2D(this.gl.TEXTURE_2D,0,this._globalParameters.internalFormat,this._globalParameters.format,this._globalParameters.type,this.source):this.sourceType==="fbo"&&this.gl.texImage2D(this.gl.TEXTURE_2D,0,this._globalParameters.internalFormat,this._size.width,this._size.height,0,this._globalParameters.format,this._globalParameters.type,this.source||null),this._uploaded||(this.renderer.nextRender.add(()=>this._onSourceUploadedCallback&&this._onSourceUploadedCallback()),this._uploaded=!0)}_getSizes(){if(this.sourceType==="fbo")return{parentWidth:this._parent._boundingRect.document.width,parentHeight:this._parent._boundingRect.document.height,sourceWidth:this._parent._boundingRect.document.width,sourceHeight:this._parent._boundingRect.document.height,xOffset:0,yOffset:0};const e=this._parent.scale?ks.set(this._parent.scale.x,this._parent.scale.y):ks.set(1,1),t=this._parent._boundingRect.document.width*e.x,i=this._parent._boundingRect.document.height*e.y,s=this._size.width,r=this._size.height,n=s/r,a=t/i;let h=0,u=0;return a>n?u=Math.min(0,i-t*(1/n)):a<n&&(h=Math.min(0,t-i*n)),{parentWidth:t,parentHeight:i,sourceWidth:s,sourceHeight:r,xOffset:h,yOffset:u}}setScale(e){if(!e.type||e.type!=="Vec2"){this.renderer.production||R(this.type+": Cannot set scale because the parameter passed is not of Vec2 type:",e);return}e.sanitizeNaNValuesWith(this.scale).max(ks.set(.001,.001)),e.equals(this.scale)||(this.scale.copy(e),this.resize())}setOffset(e){if(!e.type||e.type!=="Vec2"){this.renderer.production||R(this.type+": Cannot set offset because the parameter passed is not of Vec2 type:",scale);return}e.sanitizeNaNValuesWith(this.offset),e.equals(this.offset)||(this.offset.copy(e),this.resize())}_setSize(){if(this._parent&&this._parent._program){const e=this._getSizes();this._updateTextureMatrix(e)}}resize(){this.sourceType==="fbo"?(this._size={width:this._parent._size&&this._parent._size.width||this._parent._boundingRect.document.width,height:this._parent._size&&this._parent._size.height||this._parent._boundingRect.document.height},this._copiedFrom||(this.gl.bindTexture(this.gl.TEXTURE_2D,this._sampler.texture),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this._globalParameters.internalFormat,this._size.width,this._size.height,0,this._globalParameters.format,this._globalParameters.type,null))):this.source&&(this._size={width:this.source.naturalWidth||this.source.width||this.source.videoWidth,height:this.source.naturalHeight||this.source.height||this.source.videoHeight}),this._setSize()}_updateTextureMatrix(e){const t=ua.set(e.parentWidth/(e.parentWidth-e.xOffset),e.parentHeight/(e.parentHeight-e.yOffset),1);t.x/=this.scale.x,t.y/=this.scale.y,this._textureMatrix.matrix=ca.setFromArray([t.x,0,0,0,0,t.y,0,0,0,0,1,0,(1-t.x)/2+this.offset.x,(1-t.y)/2+this.offset.y,0,1]),this._updateMatrixUniform()}_updateMatrixUniform(){this._textureMatrix.isActive&&(this.renderer.useProgram(this._parent._program),this.gl.uniformMatrix4fv(this._textureMatrix.location,!1,this._textureMatrix.matrix.elements))}_onSourceLoaded(e){this.setSource(e),this.sourceType==="image"&&this.renderer.cache.addTexture(this)}_bindTexture(){this._canDraw&&(this.renderer.state.activeTexture!==this.index&&(this.gl.activeTexture(this.gl.TEXTURE0+this.index),this.renderer.state.activeTexture=this.index),this.gl.bindTexture(this.gl.TEXTURE_2D,this._sampler.texture),this._sampler.isTextureBound||(this._sampler.isTextureBound=!!this.gl.getParameter(this.gl.TEXTURE_BINDING_2D),this._sampler.isTextureBound&&this.renderer.needRender()))}_draw(){this._sampler.isActive&&(this._bindTexture(),this.sourceType==="video"&&this.source&&!this._videoFrameCallbackID&&this.source.readyState>=this.source.HAVE_CURRENT_DATA&&!this.source.paused&&(this._willUpdate=!0),(this._forceUpdate||this._willUpdate&&this.shouldUpdate)&&(this._state.generateMipmap=!1,this._upload()),this.sourceType==="video"&&(this._willUpdate=!1),this._forceUpdate=!1),this.parameters._shouldUpdate&&(this._updateTexParameters(),this.parameters._shouldUpdate=!1)}onSourceLoaded(e){return e&&(this._onSourceLoadedCallback=e),this}onSourceUploaded(e){return e&&(this._onSourceUploadedCallback=e),this}_dispose(e=!1){this.sourceType==="video"||this.sourceType==="image"&&!this.renderer.state.isActive?(this._loader&&this._loader._removeSource(this),this.source=null):this.sourceType==="canvas"&&(this.source.width=this.source.width,this.source=null),this._parent=null,this.gl&&!this._copiedFrom&&(e||this.sourceType!=="image"||!this.renderer.state.isActive)&&(this._canDraw=!1,this.renderer.cache.removeTexture(this),this.gl.activeTexture(this.gl.TEXTURE0+this.index),this.gl.bindTexture(this.gl.TEXTURE_2D,null),this.gl.deleteTexture(this._sampler.texture))}}class fa{constructor(e,t="anonymous"){if(this.type="TextureLoader",e=e&&e.renderer||e,!e||e.type!=="Renderer")Ue(this.type+": Renderer not passed as first argument",e);else if(!e.gl){Ue(this.type+": Renderer WebGL context is undefined",e);return}this.renderer=e,this.gl=this.renderer.gl,this.crossOrigin=t,this.elements=[]}_addElement(e,t,i,s){const r={source:e,texture:t,load:this._sourceLoaded.bind(this,e,t,i),error:this._sourceLoadError.bind(this,e,s)};return this.elements.push(r),r}_sourceLoadError(e,t,i){t&&t(e,i)}_sourceLoaded(e,t,i){t._sourceLoaded||(t._onSourceLoaded(e),this._parent&&(this._increment&&this._increment(),this.renderer.nextRender.add(()=>this._parent._onLoadingCallback&&this._parent._onLoadingCallback(t))),i&&i(t))}_getSourceType(e){let t;return typeof e=="string"?e.match(/\.(jpeg|jpg|jfif|pjpeg|pjp|gif|bmp|png|webp|svg|avif|apng)$/)!==null?t="image":e.match(/\.(webm|mp4|mpg|mpeg|avi|ogg|ogm|ogv|mov|av1)$/)!==null&&(t="video"):e.tagName.toUpperCase()==="IMG"?t="image":e.tagName.toUpperCase()==="VIDEO"?t="video":e.tagName.toUpperCase()==="CANVAS"&&(t="canvas"),t}_createImage(e){if(typeof e=="string"||!e.hasAttribute("crossOrigin")){const t=new Image;return t.crossOrigin=this.crossOrigin,typeof e=="string"?t.src=e:(t.src=e.src,e.hasAttribute("data-sampler")&&t.setAttribute("data-sampler",e.getAttribute("data-sampler"))),t}else return e}_createVideo(e){if(typeof e=="string"||e.getAttribute("crossOrigin")===null){const t=document.createElement("video");return t.crossOrigin=this.crossOrigin,typeof e=="string"?t.src=e:(t.src=e.src,e.hasAttribute("data-sampler")&&t.setAttribute("data-sampler",e.getAttribute("data-sampler"))),t}else return e}loadSource(e,t,i,s){switch(this._getSourceType(e)){case"image":this.loadImage(e,t,i,s);break;case"video":this.loadVideo(e,t,i,s);break;case"canvas":this.loadCanvas(e,t,i);break;default:this._sourceLoadError(e,s,"this source could not be converted into a texture: "+e);break}}loadSources(e,t,i,s){for(let r=0;r<e.length;r++)this.loadSource(e[r],t,i,s)}loadImage(e,t={},i,s){const r=this.renderer.cache.getTextureFromSource(e);let n=Object.assign({},t);if(this._parent&&(n=Object.assign(n,this._parent._texturesOptions)),n.loader=this,r){n.sampler=typeof e!="string"&&e.hasAttribute("data-sampler")?e.getAttribute("data-sampler"):n.sampler,n.fromTexture=r;const p=new Ci(this.renderer,n);this._sourceLoaded(r.source,p,i),this._parent&&this._addToParent(p,r.source,"image");return}const a=this._createImage(e);n.sampler=a.hasAttribute("data-sampler")?a.getAttribute("data-sampler"):n.sampler;const h=new Ci(this.renderer,n),u=this._addElement(a,h,i,s);a.complete?this._sourceLoaded(a,h,i):a.decode?a.decode().then(this._sourceLoaded.bind(this,a,h,i)).catch(()=>{a.addEventListener("load",u.load,!1),a.addEventListener("error",u.error,!1)}):(a.addEventListener("load",u.load,!1),a.addEventListener("error",u.error,!1)),this._parent&&this._addToParent(h,a,"image")}loadImages(e,t,i,s){for(let r=0;r<e.length;r++)this.loadImage(e[r],t,i,s)}loadVideo(e,t={},i,s){const r=this._createVideo(e);r.preload=!0,r.muted=!0,r.loop=!0,r.setAttribute("playsinline",""),r.crossOrigin=this.crossOrigin;let n=Object.assign({},t);this._parent&&(n=Object.assign(t,this._parent._texturesOptions)),n.loader=this,n.sampler=r.hasAttribute("data-sampler")?r.getAttribute("data-sampler"):n.sampler;const a=new Ci(this.renderer,n),h=this._addElement(r,a,i,s);r.addEventListener("canplaythrough",h.load,!1),r.addEventListener("error",h.error,!1),r.readyState>=r.HAVE_FUTURE_DATA&&i&&this._sourceLoaded(r,a,i),r.load(),this._addToParent&&this._addToParent(a,r,"video"),"requestVideoFrameCallback"in HTMLVideoElement.prototype&&(h.videoFrameCallback=a._videoFrameCallback.bind(a),a._videoFrameCallbackID=r.requestVideoFrameCallback(h.videoFrameCallback))}loadVideos(e,t,i,s){for(let r=0;r<e.length;r++)this.loadVideo(e[r],t,i,s)}loadCanvas(e,t={},i){let s=Object.assign({},t);this._parent&&(s=Object.assign(t,this._parent._texturesOptions)),s.loader=this,s.sampler=e.hasAttribute("data-sampler")?e.getAttribute("data-sampler"):s.sampler;const r=new Ci(this.renderer,s);this._addElement(e,r,i,null),this._sourceLoaded(e,r,i),this._parent&&this._addToParent(r,e,"canvas")}loadCanvases(e,t,i){for(let s=0;s<e.length;s++)this.loadCanvas(e[s],t,i)}_removeSource(e){const t=this.elements.find(i=>i.texture.uuid===e.uuid);t&&(e.sourceType==="image"?t.source.removeEventListener("load",t.load,!1):e.sourceType==="video"&&(t.videoFrameCallback&&e._videoFrameCallbackID&&t.source.cancelVideoFrameCallback(e._videoFrameCallbackID),t.source.removeEventListener("canplaythrough",t.load,!1),t.source.pause(),t.source.removeAttribute("src"),t.source.load()),t.source.removeEventListener("error",t.error,!1))}}class pa extends fa{constructor(e,t,{sourcesLoaded:i=0,sourcesToLoad:s=0,complete:r=!1,onComplete:n=()=>{}}={}){super(e,t.crossOrigin),this.type="PlaneTextureLoader",this._parent=t,this._parent.type!=="Plane"&&this._parent.type!=="PingPongPlane"&&this._parent.type!=="ShaderPass"&&(R(this.type+": Wrong parent type assigned to this loader"),this._parent=null),this.sourcesLoaded=i,this.sourcesToLoad=s,this.complete=r,this.onComplete=n}_setLoaderSize(e){this.sourcesToLoad=e,this.sourcesToLoad===0&&(this.complete=!0,this.renderer.nextRender.add(()=>this.onComplete&&this.onComplete()))}_increment(){this.sourcesLoaded++,this.sourcesLoaded>=this.sourcesToLoad&&!this.complete&&(this.complete=!0,this.renderer.nextRender.add(()=>this.onComplete&&this.onComplete()))}_addSourceToParent(e,t){if(t==="image"){const i=this._parent.images;!i.find(r=>r.src===e.src)&&i.push(e)}else if(t==="video"){const i=this._parent.videos;!i.find(r=>r.src===e.src)&&i.push(e)}else if(t==="canvas"){const i=this._parent.canvases;!i.find(r=>r.isSameNode(e))&&i.push(e)}}_addToParent(e,t,i){this._addSourceToParent(t,i),this._parent&&e.addParent(this._parent)}}class ga{constructor(e,t="Mesh",{vertexShaderID:i,fragmentShaderID:s,vertexShader:r,fragmentShader:n,uniforms:a={},widthSegments:h=1,heightSegments:u=1,renderOrder:p=0,depthTest:_=!0,cullFace:f="back",texturesOptions:d={},crossOrigin:g="anonymous"}={}){if(this.type=t,e=e&&e.renderer||e,(!e||e.type!=="Renderer")&&(Ue(this.type+": Curtains not passed as first argument or Curtains Renderer is missing",e),setTimeout(()=>{this._onErrorCallback&&this._onErrorCallback()},0)),this.renderer=e,this.gl=this.renderer.gl,!this.gl){this.renderer.production||Ue(this.type+": Unable to create a "+this.type+" because the Renderer WebGL context is not defined"),setTimeout(()=>{this._onErrorCallback&&this._onErrorCallback()},0);return}this._canDraw=!1,this.renderOrder=p,this._depthTest=_,this.cullFace=f,this.cullFace!=="back"&&this.cullFace!=="front"&&this.cullFace!=="none"&&(this.cullFace="back"),this.textures=[],this._texturesOptions=Object.assign({premultiplyAlpha:!1,anisotropy:1,floatingPoint:"none",wrapS:this.gl.CLAMP_TO_EDGE,wrapT:this.gl.CLAMP_TO_EDGE,minFilter:this.gl.LINEAR,magFilter:this.gl.LINEAR},d),this.crossOrigin=g,!r&&i&&document.getElementById(i)&&(r=document.getElementById(i).innerHTML),!n&&s&&document.getElementById(s)&&(n=document.getElementById(s).innerHTML),this._initMesh(),h=parseInt(h),u=parseInt(u),this._geometry=new da(this.renderer,{width:h,height:u}),this._program=new wr(this.renderer,{parent:this,vertexShader:r,fragmentShader:n}),this._program.compiled?(this._program.createUniforms(a),this.uniforms=this._program.uniformsManager.uniforms,this._geometry.setProgram(this._program),this.renderer.onSceneChange()):this.renderer.nextRender.add(()=>this._onErrorCallback&&this._onErrorCallback())}_initMesh(){this.uuid=an(),this.loader=new pa(this.renderer,this,{sourcesLoaded:0,initSourcesToLoad:0,complete:!1,onComplete:()=>{this._onReadyCallback&&this._onReadyCallback(),this.renderer.needRender()}}),this.images=[],this.videos=[],this.canvases=[],this.userData={},this._canDraw=!0}_restoreContext(){this._canDraw=!1,this._matrices&&(this._matrices=null),this._program=new wr(this.renderer,{parent:this,vertexShader:this._program.vsCode,fragmentShader:this._program.fsCode}),this._program.compiled&&(this._geometry.restoreContext(this._program),this._program.createUniforms(this.uniforms),this.uniforms=this._program.uniformsManager.uniforms,this._programRestored())}setRenderTarget(e){if(!e||e.type!=="RenderTarget"){this.renderer.production||R(this.type+": Could not set the render target because the argument passed is not a RenderTarget class object",e);return}this.type==="Plane"&&this.renderer.scene.removePlane(this),this.target=e,this.type==="Plane"&&this.renderer.scene.addPlane(this)}setRenderOrder(e=0){e=isNaN(e)?this.renderOrder:parseInt(e),e!==this.renderOrder&&(this.renderOrder=e,this.renderer.scene.setPlaneRenderOrder(this))}createTexture(e={}){const t=new Ci(this.renderer,Object.assign(this._texturesOptions,e));return t.addParent(this),t}addTexture(e){if(!e||e.type!=="Texture"){this.renderer.production||R(this.type+": cannot add ",e," to this "+this.type+" because it is not a valid texture");return}e.addParent(this)}loadSources(e,t={},i,s){for(let r=0;r<e.length;r++)this.loadSource(e[r],t,i,s)}loadSource(e,t={},i,s){this.loader.loadSource(e,Object.assign(t,this._texturesOptions),r=>{i&&i(r)},(r,n)=>{this.renderer.production||R(this.type+": this HTML tag could not be converted into a texture:",r.tagName),s&&s(r,n)})}loadImage(e,t={},i,s){this.loader.loadImage(e,Object.assign(t,this._texturesOptions),r=>{i&&i(r)},(r,n)=>{this.renderer.production||R(this.type+`: There has been an error:
`,n,`
while loading this image:
`,r),s&&s(r,n)})}loadVideo(e,t={},i,s){this.loader.loadVideo(e,Object.assign(t,this._texturesOptions),r=>{i&&i(r)},(r,n)=>{this.renderer.production||R(this.type+`: There has been an error:
`,n,`
while loading this video:
`,r),s&&s(r,n)})}loadCanvas(e,t={},i){this.loader.loadCanvas(e,Object.assign(t,this._texturesOptions),s=>{i&&i(s)})}loadImages(e,t={},i,s){for(let r=0;r<e.length;r++)this.loadImage(e[r],t,i,s)}loadVideos(e,t={},i,s){for(let r=0;r<e.length;r++)this.loadVideo(e[r],t,i,s)}loadCanvases(e,t={},i){for(let s=0;s<e.length;s++)this.loadCanvas(e[s],t,i)}playVideos(){for(let e=0;e<this.textures.length;e++){const t=this.textures[e];if(t.sourceType==="video"){const i=t.source.play();i!==void 0&&i.catch(s=>{this.renderer.production||R(this.type+": Could not play the video : ",s)})}}}_draw(){this.renderer.setDepthTest(this._depthTest),this.renderer.setFaceCulling(this.cullFace),this._program.updateUniforms(),this._geometry.bindBuffers(),this.renderer.state.forceBufferUpdate=!1;for(let e=0;e<this.textures.length;e++)if(this.textures[e]._draw(),this.textures[e]._sampler.isActive&&!this.textures[e]._sampler.isTextureBound)return;this._geometry.draw(),this.renderer.state.activeTexture=null,this._onAfterRenderCallback&&this._onAfterRenderCallback()}onError(e){return e&&(this._onErrorCallback=e),this}onLoading(e){return e&&(this._onLoadingCallback=e),this}onReady(e){return e&&(this._onReadyCallback=e),this}onRender(e){return e&&(this._onRenderCallback=e),this}onAfterRender(e){return e&&(this._onAfterRenderCallback=e),this}remove(){this._canDraw=!1,this.target&&this.renderer.bindFrameBuffer(null),this._dispose(),this.type==="Plane"?this.renderer.removePlane(this):this.type==="ShaderPass"&&(this.target&&(this.target._shaderPass=null,this.target.remove(),this.target=null),this.renderer.removeShaderPass(this))}_dispose(){if(this.gl){this._geometry&&this._geometry.dispose(),this.target&&this.type==="ShaderPass"&&(this.renderer.removeRenderTarget(this.target),this.textures.shift());for(let e=0;e<this.textures.length;e++)this.textures[e]._dispose();this.textures=[]}}}const Pr=new Ct,_a=new Ct;class ma extends ga{constructor(e,t,i="DOMMesh",{widthSegments:s,heightSegments:r,renderOrder:n,depthTest:a,cullFace:h,uniforms:u,vertexShaderID:p,fragmentShaderID:_,vertexShader:f,fragmentShader:d,texturesOptions:g,crossOrigin:C}={}){p=p||t&&t.getAttribute("data-vs-id"),_=_||t&&t.getAttribute("data-fs-id"),super(e,i,{widthSegments:s,heightSegments:r,renderOrder:n,depthTest:a,cullFace:h,uniforms:u,vertexShaderID:p,fragmentShaderID:_,vertexShader:f,fragmentShader:d,texturesOptions:g,crossOrigin:C}),this.gl&&(this.htmlElement=t,(!this.htmlElement||this.htmlElement.length===0)&&(this.renderer.production||R(this.type+": The HTML element you specified does not currently exists in the DOM")),this._setDocumentSizes())}_setDocumentSizes(){let e=this.htmlElement.getBoundingClientRect();this._boundingRect||(this._boundingRect={}),this._boundingRect.document={width:e.width*this.renderer.pixelRatio,height:e.height*this.renderer.pixelRatio,top:e.top*this.renderer.pixelRatio,left:e.left*this.renderer.pixelRatio}}getBoundingRect(){return{width:this._boundingRect.document.width,height:this._boundingRect.document.height,top:this._boundingRect.document.top,left:this._boundingRect.document.left,right:this._boundingRect.document.left+this._boundingRect.document.width,bottom:this._boundingRect.document.top+this._boundingRect.document.height}}resize(){this._setDocumentSizes(),this.type==="Plane"&&(this.setPerspective(this.camera.fov,this.camera.near,this.camera.far),this._setWorldSizes(),this._applyWorldPositions());for(let e=0;e<this.textures.length;e++)this.textures[e].resize();this.renderer.nextRender.add(()=>this._onAfterResizeCallback&&this._onAfterResizeCallback())}mouseToPlaneCoords(e){const t=this.scale?this.scale:_a.set(1,1),i=Pr.set((this._boundingRect.document.width-this._boundingRect.document.width*t.x)/2,(this._boundingRect.document.height-this._boundingRect.document.height*t.y)/2),s={width:this._boundingRect.document.width*t.x/this.renderer.pixelRatio,height:this._boundingRect.document.height*t.y/this.renderer.pixelRatio,top:(this._boundingRect.document.top+i.y)/this.renderer.pixelRatio,left:(this._boundingRect.document.left+i.x)/this.renderer.pixelRatio};return Pr.set((e.x-s.left)/s.width*2-1,1-(e.y-s.top)/s.height*2)}onAfterResize(e){return e&&(this._onAfterResizeCallback=e),this}}class xa{constructor({fov:e=50,near:t=.1,far:i=150,width:s,height:r,pixelRatio:n=1}={}){this.position=new re,this.projectionMatrix=new bt,this.worldMatrix=new bt,this.viewMatrix=new bt,this._shouldUpdate=!1,this.setSize(),this.setPerspective(e,t,i,s,r,n)}setFov(e){e=isNaN(e)?this.fov:parseFloat(e),e=Math.max(1,Math.min(e,179)),e!==this.fov&&(this.fov=e,this.setPosition(),this._shouldUpdate=!0),this.setCSSPerspective()}setNear(e){e=isNaN(e)?this.near:parseFloat(e),e=Math.max(e,.01),e!==this.near&&(this.near=e,this._shouldUpdate=!0)}setFar(e){e=isNaN(e)?this.far:parseFloat(e),e=Math.max(e,50),e!==this.far&&(this.far=e,this._shouldUpdate=!0)}setPixelRatio(e){e!==this.pixelRatio&&(this._shouldUpdate=!0),this.pixelRatio=e}setSize(e,t){(e!==this.width||t!==this.height)&&(this._shouldUpdate=!0),this.width=e,this.height=t}setPerspective(e,t,i,s,r,n){this.setPixelRatio(n),this.setSize(s,r),this.setFov(e),this.setNear(t),this.setFar(i),this._shouldUpdate&&this.updateProjectionMatrix()}setPosition(){this.position.set(0,0,1),this.worldMatrix.setFromArray([1,0,0,0,0,1,0,0,0,0,1,0,this.position.x,this.position.y,this.position.z,1]),this.viewMatrix=this.viewMatrix.copy(this.worldMatrix).getInverse()}setCSSPerspective(){this.CSSPerspective=Math.pow(Math.pow(this.width/(2*this.pixelRatio),2)+Math.pow(this.height/(2*this.pixelRatio),2),.5)/Math.tan(this.fov*.5*Math.PI/180)}getScreenRatiosFromFov(e=0){const t=this.position.z;e<t?e-=t:e+=t;const i=this.fov*Math.PI/180,s=2*Math.tan(i/2)*Math.abs(e);return{width:s*this.width/this.height,height:s}}updateProjectionMatrix(){const e=this.width/this.height,t=this.near*Math.tan(Math.PI/180*.5*this.fov),i=2*t,s=e*i,r=-.5*s,n=r+s,a=t-i,h=2*this.near/(n-r),u=2*this.near/(t-a),p=(n+r)/(n-r),_=(t+a)/(t-a),f=-(this.far+this.near)/(this.far-this.near),d=-2*this.far*this.near/(this.far-this.near);this.projectionMatrix.setFromArray([h,0,0,0,0,u,0,0,p,_,f,-1,0,0,d,0])}forceUpdate(){this._shouldUpdate=!0}cancelUpdate(){this._shouldUpdate=!1}}class bs{constructor(e=new Float32Array([0,0,0,1]),t="XYZ"){this.type="Quat",this.elements=e,this.axisOrder=t}setFromArray(e){return this.elements[0]=e[0],this.elements[1]=e[1],this.elements[2]=e[2],this.elements[3]=e[3],this}setAxisOrder(e){switch(e=e.toUpperCase(),e){case"XYZ":case"YXZ":case"ZXY":case"ZYX":case"YZX":case"XZY":this.axisOrder=e;break;default:this.axisOrder="XYZ"}return this}copy(e){return this.elements=e.elements,this.axisOrder=e.axisOrder,this}clone(){return new bs().copy(this)}equals(e){return this.elements[0]===e.elements[0]&&this.elements[1]===e.elements[1]&&this.elements[2]===e.elements[2]&&this.elements[3]===e.elements[3]&&this.axisOrder===e.axisOrder}setFromVec3(e){const t=e.x*.5,i=e.y*.5,s=e.z*.5,r=Math.cos(t),n=Math.cos(i),a=Math.cos(s),h=Math.sin(t),u=Math.sin(i),p=Math.sin(s);return this.axisOrder==="XYZ"?(this.elements[0]=h*n*a+r*u*p,this.elements[1]=r*u*a-h*n*p,this.elements[2]=r*n*p+h*u*a,this.elements[3]=r*n*a-h*u*p):this.axisOrder==="YXZ"?(this.elements[0]=h*n*a+r*u*p,this.elements[1]=r*u*a-h*n*p,this.elements[2]=r*n*p-h*u*a,this.elements[3]=r*n*a+h*u*p):this.axisOrder==="ZXY"?(this.elements[0]=h*n*a-r*u*p,this.elements[1]=r*u*a+h*n*p,this.elements[2]=r*n*p+h*u*a,this.elements[3]=r*n*a-h*u*p):this.axisOrder==="ZYX"?(this.elements[0]=h*n*a-r*u*p,this.elements[1]=r*u*a+h*n*p,this.elements[2]=r*n*p-h*u*a,this.elements[3]=r*n*a+h*u*p):this.axisOrder==="YZX"?(this.elements[0]=h*n*a+r*u*p,this.elements[1]=r*u*a+h*n*p,this.elements[2]=r*n*p-h*u*a,this.elements[3]=r*n*a-h*u*p):this.axisOrder==="XZY"&&(this.elements[0]=h*n*a-r*u*p,this.elements[1]=r*u*a-h*n*p,this.elements[2]=r*n*p+h*u*a,this.elements[3]=r*n*a+h*u*p),this}}const ya=new Ct,ba=new re,va=new re,wa=new re,Pa=new re,Ta=new re,Ra=new re,Je=new re,et=new re,Tr=new bs,Sa=new re(.5,.5,0),Ea=new re,Ma=new re,Ca=new re,Aa=new re,ka=new Ct;class Da extends ma{constructor(e,t,{widthSegments:i,heightSegments:s,renderOrder:r,depthTest:n,cullFace:a,uniforms:h,vertexShaderID:u,fragmentShaderID:p,vertexShader:_,fragmentShader:f,texturesOptions:d,crossOrigin:g,alwaysDraw:C=!1,visible:S=!0,transparent:z=!1,drawCheckMargins:E={top:0,right:0,bottom:0,left:0},autoloadSources:B=!0,watchScroll:v=!0,fov:j=50}={}){super(e,t,"Plane",{widthSegments:i,heightSegments:s,renderOrder:r,depthTest:n,cullFace:a,uniforms:h,vertexShaderID:u,fragmentShaderID:p,vertexShader:_,fragmentShader:f,texturesOptions:d,crossOrigin:g}),this.gl&&(this.index=this.renderer.planes.length,this.target=null,this.alwaysDraw=C,this._shouldDraw=!0,this.visible=S,this._transparent=z,this.drawCheckMargins=E,this.autoloadSources=B,this.watchScroll=v,this._updateMVMatrix=!1,this.camera=new xa({fov:j,width:this.renderer._boundingRect.width,height:this.renderer._boundingRect.height,pixelRatio:this.renderer.pixelRatio}),this._program.compiled&&(this._initPlane(),this.renderer.scene.addPlane(this),this.renderer.planes.push(this)))}_programRestored(){this.target&&this.setRenderTarget(this.renderer.renderTargets[this.target.index]),this._initMatrices(),this.setPerspective(this.camera.fov,this.camera.near,this.camera.far),this._setWorldSizes(),this._applyWorldPositions(),this.renderer.scene.addPlane(this);for(let e=0;e<this.textures.length;e++)this.textures[e]._parent=this,this.textures[e]._restoreContext();this._canDraw=!0}_initPlane(){this._initTransformValues(),this._initPositions(),this.setPerspective(this.camera.fov,this.camera.near,this.camera.far),this._initSources()}_initTransformValues(){this.rotation=new re,this.rotation.onChange(()=>this._applyRotation()),this.quaternion=new bs,this.relativeTranslation=new re,this.relativeTranslation.onChange(()=>this._setTranslation()),this._translation=new re,this.scale=new re(1),this.scale.onChange(()=>{this.scale.z=1,this._applyScale()}),this.transformOrigin=new re(.5,.5,0),this.transformOrigin.onChange(()=>{this._setWorldTransformOrigin(),this._updateMVMatrix=!0})}resetPlane(e){this._initTransformValues(),this._setWorldTransformOrigin(),e!==null&&e?(this.htmlElement=e,this.resize()):!e&&!this.renderer.production&&R(this.type+": You are trying to reset a plane with a HTML element that does not exist. The old HTML element will be kept instead.")}removeRenderTarget(){this.target&&(this.renderer.scene.removePlane(this),this.target=null,this.renderer.scene.addPlane(this))}_initPositions(){this._initMatrices(),this._setWorldSizes(),this._applyWorldPositions()}_initMatrices(){const e=new bt;this._matrices={world:{matrix:e},modelView:{name:"uMVMatrix",matrix:e,location:this.gl.getUniformLocation(this._program.program,"uMVMatrix")},projection:{name:"uPMatrix",matrix:e,location:this.gl.getUniformLocation(this._program.program,"uPMatrix")},modelViewProjection:{matrix:e}}}_setPerspectiveMatrix(){this.camera._shouldUpdate&&(this.renderer.useProgram(this._program),this.gl.uniformMatrix4fv(this._matrices.projection.location,!1,this._matrices.projection.matrix.elements)),this.camera.cancelUpdate()}setPerspective(e,t,i){this.camera.setPerspective(e,t,i,this.renderer._boundingRect.width,this.renderer._boundingRect.height,this.renderer.pixelRatio),this.renderer.state.isContextLost&&this.camera.forceUpdate(),this._matrices.projection.matrix=this.camera.projectionMatrix,this.camera._shouldUpdate&&(this._setWorldSizes(),this._applyWorldPositions(),this._translation.z=this.relativeTranslation.z/this.camera.CSSPerspective),this._updateMVMatrix=this.camera._shouldUpdate}_setMVMatrix(){this._updateMVMatrix&&(this._matrices.world.matrix=this._matrices.world.matrix.composeFromOrigin(this._translation,this.quaternion,this.scale,this._boundingRect.world.transformOrigin),this._matrices.world.matrix.scale({x:this._boundingRect.world.width,y:this._boundingRect.world.height,z:1}),this._matrices.modelView.matrix.copy(this._matrices.world.matrix),this._matrices.modelView.matrix.elements[14]-=this.camera.position.z,this._matrices.modelViewProjection.matrix=this._matrices.projection.matrix.multiply(this._matrices.modelView.matrix),this.alwaysDraw||this._shouldDrawCheck(),this.renderer.useProgram(this._program),this.gl.uniformMatrix4fv(this._matrices.modelView.location,!1,this._matrices.modelView.matrix.elements)),this._updateMVMatrix=!1}_setWorldTransformOrigin(){this._boundingRect.world.transformOrigin=new re((this.transformOrigin.x*2-1)*this._boundingRect.world.width,-(this.transformOrigin.y*2-1)*this._boundingRect.world.height,this.transformOrigin.z)}_documentToWorldSpace(e){return va.set(e.x*this.renderer.pixelRatio/this.renderer._boundingRect.width*this._boundingRect.world.ratios.width,-(e.y*this.renderer.pixelRatio/this.renderer._boundingRect.height)*this._boundingRect.world.ratios.height,e.z)}_setWorldSizes(){const e=this.camera.getScreenRatiosFromFov();this._boundingRect.world={width:this._boundingRect.document.width/this.renderer._boundingRect.width*e.width/2,height:this._boundingRect.document.height/this.renderer._boundingRect.height*e.height/2,ratios:e},this._setWorldTransformOrigin()}_setWorldPosition(){const e={x:this._boundingRect.document.width/2+this._boundingRect.document.left,y:this._boundingRect.document.height/2+this._boundingRect.document.top},t={x:this.renderer._boundingRect.width/2+this.renderer._boundingRect.left,y:this.renderer._boundingRect.height/2+this.renderer._boundingRect.top};this._boundingRect.world.top=(t.y-e.y)/this.renderer._boundingRect.height*this._boundingRect.world.ratios.height,this._boundingRect.world.left=(e.x-t.x)/this.renderer._boundingRect.width*this._boundingRect.world.ratios.width}setScale(e){if(!e.type||e.type!=="Vec2"){this.renderer.production||R(this.type+": Cannot set scale because the parameter passed is not of Vec2 type:",e);return}e.sanitizeNaNValuesWith(this.scale).max(ya.set(.001,.001)),(e.x!==this.scale.x||e.y!==this.scale.y)&&(this.scale.set(e.x,e.y,1),this._applyScale())}_applyScale(){for(let e=0;e<this.textures.length;e++)this.textures[e].resize();this._updateMVMatrix=!0}setRotation(e){if(!e.type||e.type!=="Vec3"){this.renderer.production||R(this.type+": Cannot set rotation because the parameter passed is not of Vec3 type:",e);return}e.sanitizeNaNValuesWith(this.rotation),e.equals(this.rotation)||(this.rotation.copy(e),this._applyRotation())}_applyRotation(){this.quaternion.setFromVec3(this.rotation),this._updateMVMatrix=!0}setTransformOrigin(e){if(!e.type||e.type!=="Vec3"){this.renderer.production||R(this.type+": Cannot set transform origin because the parameter passed is not of Vec3 type:",e);return}e.sanitizeNaNValuesWith(this.transformOrigin),e.equals(this.transformOrigin)||(this.transformOrigin.copy(e),this._setWorldTransformOrigin(),this._updateMVMatrix=!0)}_setTranslation(){let e=ba.set(0,0,0);this.relativeTranslation.equals(e)||(e=this._documentToWorldSpace(this.relativeTranslation)),this._translation.set(this._boundingRect.world.left+e.x,this._boundingRect.world.top+e.y,this.relativeTranslation.z/this.camera.CSSPerspective),this._updateMVMatrix=!0}setRelativeTranslation(e){if(!e.type||e.type!=="Vec3"){this.renderer.production||R(this.type+": Cannot set translation because the parameter passed is not of Vec3 type:",e);return}e.sanitizeNaNValuesWith(this.relativeTranslation),e.equals(this.relativeTranslation)||(this.relativeTranslation.copy(e),this._setTranslation())}_applyWorldPositions(){this._setWorldPosition(),this._setTranslation()}updatePosition(){this._setDocumentSizes(),this._applyWorldPositions()}updateScrollPosition(e,t){(e||t)&&(this._boundingRect.document.top+=t*this.renderer.pixelRatio,this._boundingRect.document.left+=e*this.renderer.pixelRatio,this._applyWorldPositions())}_getIntersection(e,t){let i=t.clone().sub(e),s=e.clone();for(;s.z>-1;)s.add(i);return s}_getNearPlaneIntersections(e,t,i){const s=this._matrices.modelViewProjection.matrix;if(i.length===1)i[0]===0?(t[0]=this._getIntersection(t[1],Je.set(.95,1,0).applyMat4(s)),t.push(this._getIntersection(t[3],et.set(-1,-.95,0).applyMat4(s)))):i[0]===1?(t[1]=this._getIntersection(t[0],Je.set(-.95,1,0).applyMat4(s)),t.push(this._getIntersection(t[2],et.set(1,-.95,0).applyMat4(s)))):i[0]===2?(t[2]=this._getIntersection(t[3],Je.set(-.95,-1,0).applyMat4(s)),t.push(this._getIntersection(t[1],et.set(1,.95,0).applyMat4(s)))):i[0]===3&&(t[3]=this._getIntersection(t[2],Je.set(.95,-1,0).applyMat4(s)),t.push(this._getIntersection(t[0],et.set(-1,.95,0).applyMat4(s))));else if(i.length===2)i[0]===0&&i[1]===1?(t[0]=this._getIntersection(t[3],Je.set(-1,-.95,0).applyMat4(s)),t[1]=this._getIntersection(t[2],et.set(1,-.95,0).applyMat4(s))):i[0]===1&&i[1]===2?(t[1]=this._getIntersection(t[0],Je.set(-.95,1,0).applyMat4(s)),t[2]=this._getIntersection(t[3],et.set(-.95,-1,0).applyMat4(s))):i[0]===2&&i[1]===3?(t[2]=this._getIntersection(t[1],Je.set(1,.95,0).applyMat4(s)),t[3]=this._getIntersection(t[0],et.set(-1,.95,0).applyMat4(s))):i[0]===0&&i[1]===3&&(t[0]=this._getIntersection(t[1],Je.set(.95,1,0).applyMat4(s)),t[3]=this._getIntersection(t[2],et.set(.95,-1,0).applyMat4(s)));else if(i.length===3){let r=0;for(let n=0;n<e.length;n++)i.includes(n)||(r=n);t=[t[r]],r===0?(t.push(this._getIntersection(t[0],Je.set(-.95,1,0).applyMat4(s))),t.push(this._getIntersection(t[0],et.set(-1,.95,0).applyMat4(s)))):r===1?(t.push(this._getIntersection(t[0],Je.set(.95,1,0).applyMat4(s))),t.push(this._getIntersection(t[0],et.set(1,.95,0).applyMat4(s)))):r===2?(t.push(this._getIntersection(t[0],Je.set(.95,-1,0).applyMat4(s))),t.push(this._getIntersection(t[0],et.set(1,-.95,0).applyMat4(s)))):r===3&&(t.push(this._getIntersection(t[0],Je.set(-.95,-1,0).applyMat4(s))),t.push(this._getIntersection(t[0],et.set(-1-.95,0).applyMat4(s))))}else for(let r=0;r<e.length;r++)t[r][0]=1e4,t[r][1]=1e4;return t}_getWorldCoords(){const e=[wa.set(-1,1,0),Pa.set(1,1,0),Ta.set(1,-1,0),Ra.set(-1,-1,0)];let t=[],i=[];for(let h=0;h<e.length;h++){const u=e[h].applyMat4(this._matrices.modelViewProjection.matrix);t.push(u),Math.abs(u.z)>1&&i.push(h)}i.length&&(t=this._getNearPlaneIntersections(e,t,i));let s=1/0,r=-1/0,n=1/0,a=-1/0;for(let h=0;h<t.length;h++){const u=t[h];u.x<s&&(s=u.x),u.x>r&&(r=u.x),u.y<n&&(n=u.y),u.y>a&&(a=u.y)}return{top:a,right:r,bottom:n,left:s}}_computeWebGLBoundingRect(){const e=this._getWorldCoords();let t={top:1-(e.top+1)/2,right:(e.right+1)/2,bottom:1-(e.bottom+1)/2,left:(e.left+1)/2};t.width=t.right-t.left,t.height=t.bottom-t.top,this._boundingRect.worldToDocument={width:t.width*this.renderer._boundingRect.width,height:t.height*this.renderer._boundingRect.height,top:t.top*this.renderer._boundingRect.height+this.renderer._boundingRect.top,left:t.left*this.renderer._boundingRect.width+this.renderer._boundingRect.left,right:t.left*this.renderer._boundingRect.width+this.renderer._boundingRect.left+t.width*this.renderer._boundingRect.width,bottom:t.top*this.renderer._boundingRect.height+this.renderer._boundingRect.top+t.height*this.renderer._boundingRect.height}}getWebGLBoundingRect(){if(this._matrices.modelViewProjection)(!this._boundingRect.worldToDocument||this.alwaysDraw)&&this._computeWebGLBoundingRect();else return this._boundingRect.document;return this._boundingRect.worldToDocument}_getWebGLDrawRect(){return this._computeWebGLBoundingRect(),{top:this._boundingRect.worldToDocument.top-this.drawCheckMargins.top,right:this._boundingRect.worldToDocument.right+this.drawCheckMargins.right,bottom:this._boundingRect.worldToDocument.bottom+this.drawCheckMargins.bottom,left:this._boundingRect.worldToDocument.left-this.drawCheckMargins.left}}_shouldDrawCheck(){const e=this._getWebGLDrawRect();Math.round(e.right)<=this.renderer._boundingRect.left||Math.round(e.left)>=this.renderer._boundingRect.left+this.renderer._boundingRect.width||Math.round(e.bottom)<=this.renderer._boundingRect.top||Math.round(e.top)>=this.renderer._boundingRect.top+this.renderer._boundingRect.height?this._shouldDraw&&(this._shouldDraw=!1,this.renderer.nextRender.add(()=>this._onLeaveViewCallback&&this._onLeaveViewCallback())):(this._shouldDraw||this.renderer.nextRender.add(()=>this._onReEnterViewCallback&&this._onReEnterViewCallback()),this._shouldDraw=!0)}isDrawn(){return this._canDraw&&this.visible&&(this._shouldDraw||this.alwaysDraw)}enableDepthTest(e){this._depthTest=e}_initSources(){let e=0;if(this.autoloadSources){const t=this.htmlElement.getElementsByTagName("img"),i=this.htmlElement.getElementsByTagName("video"),s=this.htmlElement.getElementsByTagName("canvas");t.length&&this.loadImages(t),i.length&&this.loadVideos(i),s.length&&this.loadCanvases(s),e=t.length+i.length+s.length}this.loader._setLoaderSize(e),this._canDraw=!0}_startDrawing(){this._canDraw&&(this._onRenderCallback&&this._onRenderCallback(),this.target?this.renderer.bindFrameBuffer(this.target):this.renderer.state.scenePassIndex===null&&this.renderer.bindFrameBuffer(null),this._setPerspectiveMatrix(),this._setMVMatrix(),(this.alwaysDraw||this._shouldDraw)&&this.visible&&this._draw())}mouseToPlaneCoords(e){if(Tr.setAxisOrder(this.quaternion.axisOrder),Tr.equals(this.quaternion)&&Sa.equals(this.transformOrigin))return super.mouseToPlaneCoords(e);{const t={x:2*(e.x/(this.renderer._boundingRect.width/this.renderer.pixelRatio))-1,y:2*(1-e.y/(this.renderer._boundingRect.height/this.renderer.pixelRatio))-1},i=this.camera.position.clone(),s=Ea.set(t.x,t.y,-.5);s.unproject(this.camera),s.sub(i).normalize();const r=Ma.set(0,0,-1);r.applyQuat(this.quaternion).normalize();const n=Aa.set(0,0,0),a=r.dot(s);if(Math.abs(a)>=1e-4){const h=this._matrices.world.matrix.getInverse().multiply(this.camera.viewMatrix),u=this._boundingRect.world.transformOrigin.clone().add(this._translation),p=Ca.set(this._translation.x-u.x,this._translation.y-u.y,this._translation.z-u.z);p.applyQuat(this.quaternion),u.add(p);const _=r.dot(u.clone().sub(i))/a;n.copy(i.add(s.multiplyScalar(_))),n.applyMat4(h)}else n.set(1/0,1/0,1/0);return ka.set(n.x,n.y)}}onReEnterView(e){return e&&(this._onReEnterViewCallback=e),this}onLeaveView(e){return e&&(this._onLeaveViewCallback=e),this}}const hn=o=>{const e={};return Object.keys(o).forEach(t=>{o[t]&&o[t].type?e[t]=o[t].default:e[t]=o[t]}),e},ts={subscriptions:{onAfterResize:[],onContextLost:[],onContextRestored:[],onError:[],onSuccess:[],onRender:[],onScroll:[]},kebabCase:{onAfterResize:"after-resize",onContextLost:"context-lost",onContextRestored:"context-restored",onError:"error",onSuccess:"success",onRender:"render",onScroll:"scroll"},isValidEvent(o){return!!Object.keys(this.subscriptions).find(e=>o===e)},addSubscription(o){if(!this.isValidEvent(o.event))return;this.subscriptions[o.event].find(t=>t.id===o.id)||this.subscriptions[o.event].push(o)},removeSubscription(o){this.isValidEvent(o.event)&&(this.subscriptions[o.event]=this.subscriptions[o.event].filter(e=>e.id!==o.id))}},Fa={alpha:{type:Boolean,default:!0},antialias:{type:Boolean,default:!0},permultipliedAlpha:{type:Boolean,default:!1},depth:{type:Boolean,default:!0},preserveDrawingBuffer:{type:Boolean,default:!1},failIfMajorPerformanceCaveat:{type:Boolean,default:!0},stencil:{type:Boolean,default:!1},autoRender:{type:Boolean,default:!0},autoResize:{type:Boolean,default:!0},pixelRatio:{type:Number,default:1},renderingScale:{type:Number,default:1},watchScroll:{type:Boolean,default:!0},production:{type:Boolean,default:!0}};var Zs={name:"Curtains",props:{params:{type:Object,default:Fa}},emits:["error","success","context-lost","context-restored","after-resize","render","scroll"],setup(o,{emit:e}){const t=Ws(null);tr("curtainsEvents",ts);const i=hn(o.params),s=un(new Zn(i));return tr("curtains",cn(s)),Ii(()=>{s.setContainer(t.value),Object.keys(ts.subscriptions).forEach(r=>{s[r](()=>{e(ts.kebabCase[r],Ui(s)),ts.subscriptions[r].forEach(n=>{n.callback&&n.callback(Ui(s))})})})}),Rr(()=>{s.dispose()}),{container:t}}};function Oa(o,e,t,i,s,r){return ps(),Gs(Er,null,[Vt("div",fn({ref:"container"},o.$attrs),null,16),Sr(o.$slots,"default")],64)}Zs.render=Oa;Zs.__file="src/vue-curtains/components/Curtains/index.vue";let is;function ln(o=()=>{}){let e=!1;const t=Mr("curtains",null),i=()=>{is&&e&&o(is)};Ii(()=>{e=!0,i()}),is?i():ui(()=>t.container,async s=>{s&&(is=Ui(t),i())},{immediate:!0})}const La={vertexShader:{type:String,default:null},vertexShaderID:{type:String,default:null},fragmentShader:{type:String,default:null},fragmentShaderID:{type:String,default:null},widthSegments:{type:Number,default:1},heightSegments:{type:Number,default:1},renderOrder:{type:Number,default:0},depthTest:{type:Boolean,default:!0},transparent:{type:Boolean,default:!1},cullFace:{type:String,default:"back"},alwaysDraw:{type:Boolean,default:!1},visible:{type:Boolean,default:!0},drawCheckMargins:{type:Object,default:{top:0,right:0,bottom:0,left:0}},watchScroll:{type:Boolean,default:!0},autoloadSources:{type:Boolean,default:!0},texturesOptions:{type:Object,default:{}},crossOrigin:{type:String,default:""},fov:{type:Number,default:50},uniforms:{type:Object,default:{}},target:null,relativeTranslation:null,rotation:null,scale:null,transformOrigin:null};var Ks={name:"Plane",props:{params:{type:Object,default:La}},emits:["before-create","error","loading","ready","leave-view","re-enter-view","after-resize","render","after-render","before-remove"],setup(o,{emit:e}){let t;const i=Ws(null),s=Mr("renderTarget",null),r=hn(o.params),n=a=>{a.renderer&&t.setRenderTarget(a)};return ln(a=>{e("before-create"),t=new Da(a,i.value,r);const h=s&&s.value?s&&s.value:r.target?r.target:null;h&&n(Ui(h)),t.onError(()=>e("error",t)).onLoading(u=>e("loading",t,u)).onReady(()=>e("ready",t)).onAfterResize(()=>e("after-resize",t)).onLeaveView(()=>e("leave-view",t)).onReEnterView(()=>e("re-enter-view",t)).onRender(()=>e("render",t)).onAfterRender(()=>e("after-render",t))}),Rr(()=>{t&&(e("before-remove",t),t.remove())}),["alwaysDraw","cullFace","drawCheckMargins","visible","watchScroll"].forEach(a=>{ui(()=>o.params[a],h=>{t[a]=h})}),ui(()=>o.params.depthTest,a=>{t.enableDepthTest(a)}),ui(()=>o.params.renderOrder,a=>{t.setRenderOrder(a)}),ui(()=>o.params.target,a=>{n(a)},{deep:!0}),ui(()=>s,a=>{a.value&&n(Ui(a.value))},{deep:!0}),{planeEl:i}}};const za={ref:"planeEl"};function Va(o,e,t,i,s,r){return ps(),Gs("div",za,[Sr(o.$slots,"default")],512)}Ks.render=Va;Ks.__file="src/vue-curtains/components/Plane/index.vue";const Ia=`
  precision mediump float;
  // default mandatory variables
  attribute vec3 aVertexPosition;
  attribute vec2 aTextureCoord;
  uniform mat4 uMVMatrix;
  uniform mat4 uPMatrix;
  
  // our texture matrix uniform
  uniform mat4 uTextureMatrix;
  // custom variables
  varying vec3 vVertexPosition;
  varying vec2 vTextureCoord;
  uniform float uTime;
  uniform vec2 uResolution;
  uniform vec2 uMousePosition;
  uniform float uMouseMoveStrength;
  void main() {
      vec3 vertexPosition = aVertexPosition;
      // get the distance between our vertex and the mouse position
      float distanceFromMouse = distance(uMousePosition, vec2(vertexPosition.x, vertexPosition.y));
      // calculate our wave effect
      float waveSinusoid = cos(5.0 * (distanceFromMouse - (uTime / 75.0)));
      // attenuate the effect based on mouse distance
      float distanceStrength = (0.4 / (distanceFromMouse + 0.4));
      // calculate our distortion effect
      float distortionEffect = distanceStrength * waveSinusoid * uMouseMoveStrength;
      // apply it to our vertex position
      vertexPosition.z +=  distortionEffect / 30.0;
      vertexPosition.x +=  (distortionEffect / 30.0 * (uResolution.x / uResolution.y) * (uMousePosition.x - vertexPosition.x));
      vertexPosition.y +=  distortionEffect / 30.0 * (uMousePosition.y - vertexPosition.y);
      gl_Position = uPMatrix * uMVMatrix * vec4(vertexPosition, 1.0);
      // varyings
      vTextureCoord = (uTextureMatrix * vec4(aTextureCoord, 0.0, 1.0)).xy;
      vVertexPosition = vertexPosition;
  }
`,Ua=`
  precision mediump float;
  varying vec3 vVertexPosition;
  varying vec2 vTextureCoord;
  uniform sampler2D uTexture;
  void main() {
      // apply our texture
      vec4 finalColor = texture2D(uTexture, vTextureCoord);
      // fake shadows based on vertex position along Z axis
      finalColor.rgb -= clamp(-vVertexPosition.z, 0.0, 1.0);
      // fake lights based on vertex position along Z axis
      finalColor.rgb += clamp(vVertexPosition.z, 0.0, 1.0);
      // handling premultiplied alpha (useful if we were using a png with transparency)
      finalColor = vec4(finalColor.rgb * finalColor.a, finalColor.a);
      gl_FragColor = finalColor;
  }
`;const Na=o=>(_n("data-v-c656c55f"),o=o(),mn(),o),Ba=Na(()=>Vt("img",{class:"hidden",src:"https://pbs.twimg.com/media/FyNbPLxaIAAHv7f.jpg","data-sampler":"uTexture",alt:"專案圖片"},null,-1)),Wa={__name:"SimplePlane",setup(o){let e;ln(f=>{e=f,e.setContainer(document.getElementById("SimplePlane"))});const t=new Cs,i=new Cs,s={max:0,applied:0},r={vertexShader:Ia,fragmentShader:Ua,widthSegments:20,heightSegments:20,uniforms:{resolution:{name:"uResolution",type:"2f",value:[0,0]},time:{name:"uTime",type:"1f",value:0},mousePosition:{name:"uMousePosition",type:"2f",value:t},mouseMoveStrength:{name:"uMouseMoveStrength",type:"1f",value:0}}};let n;const a=f=>{const d=f.getBoundingRect();f.uniforms.resolution.value=[d.width,d.height]},h=f=>{n=f,f.setPerspective(35),s.max=2,a(f)},u=f=>{f.uniforms.time.value++,s.applied+=(s.max-s.applied)*.02,s.max+=(0-s.max)*.01,f.uniforms.mouseMoveStrength.value=s.applied},p=f=>{a(f)},_=f=>{if(!e)return;i.copy(t);const d=new Cs;if(f.targetTouches?d.set(f.targetTouches[0].clientX,f.targetTouches[0].clientY):d.set(f.clientX,f.clientY),t.set(e.lerp(t.x,d.x,.3),e.lerp(t.y,d.y,.3)),i.x&&i.y){let g=Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2))/30;g=Math.min(4,g),g>=s.max&&(s.max=g)}n&&(n.uniforms.mousePosition.value=n.mouseToPlaneCoords(t))};return Ii(()=>{window.addEventListener("mousemove",_),window.addEventListener("touchmove",_,{passive:!0})}),pn(()=>{window.removeEventListener("mousemove",_),window.removeEventListener("touchmove",_,{passive:!0})}),(f,d)=>(ps(),gn(Ar(Ks),{id:"SimplePlane",params:r,onRender:u,onAfterResize:p,onReady:h},{default:Cr(()=>[Ba]),_:1}))}},Ga=yn(Wa,[["__scopeId","data-v-c656c55f"]]);const Xa={class:"w-full h-screen bg-yellow-300"},Ha=xn('<div class="w-full h-screen bg-gray-500 flex justify-center items-center"><div id="wrapper"><div id="text-container"><p class="text" id="text-base">Get to know us</p><p class="text" id="text-secondary">Get to know us</p></div></div></div>',1),Ya={class:"w-full h-screen bg-red-500 flex justify-center items-center"},ja=Vt("div",{class:"w-full h-screen bg-red-500 flex justify-center items-center"},null,-1),$a=Vt("div",{class:"w-full h-screen bg-red-500 flex justify-center items-center"},null,-1),qa=Vt("div",{class:"w-full h-screen bg-red-500 flex justify-center items-center"},null,-1),Ja={__name:"TestView",setup(o){Kt.registerPlugin(L);const e=Ws(null);Ii(()=>{Kt.to(e.value,{x:200,scrollTrigger:{trigger:e.value,start:"top center",end:"bottom center",scrub:!0}})});const t={pixelRatio:Math.min(1.5,window.devicePixelRatio)},i=Kt.utils.clamp(-100,100),s={yPercent:0},r=Kt.quickSetter("#text-secondary","yPercent");return Ii(()=>{Kt.to(e.value,{x:200,scrollTrigger:{trigger:e.value,start:"top center",end:"bottom center",scrub:!0}}),L.create({end:()=>`+=${window.innerHeight*2}`,onUpdate:({getVelocity:n})=>{const a=i(n()/50);Math.abs(a)>Math.abs(s.yPercent)&&(s.yPercent=a,Kt.to(s,{duration:1,ease:"power3",onUpdate:()=>{r(s.yPercent)},overwrite:!0,yPercent:0}))},pin:!0,trigger:"#wrapper"})}),(n,a)=>(ps(),Gs(Er,null,[ir(Ar(Zs),{id:"CurtainsCanvas",params:t},{default:Cr(()=>[ir(Ga)]),_:1}),Vt("div",Xa,[Ha,Vt("div",Ya,[Vt("div",{class:"w-20 h-20 bg-green-500 block",ref_key:"box",ref:e},"test",512)]),ja,$a,qa])],64))}};export{Ja as default};
